{% extends "base.html" %}

{% block title %}State Procurement Portals - All 50 States{% endblock %}

{% block content %}
<div class="container-fluid py-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 250px;">
    <div class="container">
        <h1 class="display-4 text-white mb-3">
            <i class="fas fa-flag-usa me-3"></i>State Procurement Portals
        </h1>
        <p class="lead text-white mb-0">
            Direct access to procurement websites for all 50 states and Washington DC
        </p>
    </div>
</div>

<div class="container my-5">
    <!-- Important Notice -->
    <div class="alert alert-info shadow-sm mb-4">
        <div class="d-flex align-items-start">
            <i class="fas fa-info-circle fa-2x me-3 mt-1"></i>
            <div>
                <h5 class="alert-heading mb-2">External Government Links</h5>
                <p class="mb-0">
                    The links below redirect to official state government procurement websites. These are external sites managed by each state. 
                    If a link doesn't work, the state may have updated their website structure. You can search for "[State Name] procurement" 
                    to find their current portal.
                </p>
            </div>
        </div>
    </div>

    <!-- State Selector -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="stateDropdown" class="form-label fw-bold">
                        <i class="fas fa-map-marked-alt me-2"></i>Select State
                    </label>
                    <select class="form-select form-select-lg" id="stateDropdown" onchange="scrollToState(this.value)">
                        <option value="">-- Choose a state --</option>
                        <option value="alabama">Alabama</option>
                        <option value="alaska">Alaska</option>
                        <option value="arizona">Arizona</option>
                        <option value="arkansas">Arkansas</option>
                        <option value="california">California</option>
                        <option value="colorado">Colorado</option>
                        <option value="connecticut">Connecticut</option>
                        <option value="delaware">Delaware</option>
                        <option value="florida">Florida</option>
                        <option value="georgia">Georgia</option>
                        <option value="hawaii">Hawaii</option>
                        <option value="idaho">Idaho</option>
                        <option value="illinois">Illinois</option>
                        <option value="indiana">Indiana</option>
                        <option value="iowa">Iowa</option>
                        <option value="kansas">Kansas</option>
                        <option value="kentucky">Kentucky</option>
                        <option value="louisiana">Louisiana</option>
                        <option value="maine">Maine</option>
                        <option value="maryland">Maryland</option>
                        <option value="massachusetts">Massachusetts</option>
                        <option value="michigan">Michigan</option>
                        <option value="minnesota">Minnesota</option>
                        <option value="mississippi">Mississippi</option>
                        <option value="missouri">Missouri</option>
                        <option value="montana">Montana</option>
                        <option value="nebraska">Nebraska</option>
                        <option value="nevada">Nevada</option>
                        <option value="new-hampshire">New Hampshire</option>
                        <option value="new-jersey">New Jersey</option>
                        <option value="new-mexico">New Mexico</option>
                        <option value="new-york">New York</option>
                        <option value="north-carolina">North Carolina</option>
                        <option value="north-dakota">North Dakota</option>
                        <option value="ohio">Ohio</option>
                        <option value="oklahoma">Oklahoma</option>
                        <option value="oregon">Oregon</option>
                        <option value="pennsylvania">Pennsylvania</option>
                        <option value="rhode-island">Rhode Island</option>
                        <option value="south-carolina">South Carolina</option>
                        <option value="south-dakota">South Dakota</option>
                        <option value="tennessee">Tennessee</option>
                        <option value="texas">Texas</option>
                        <option value="utah">Utah</option>
                        <option value="vermont">Vermont</option>
                        <option value="virginia">Virginia</option>
                        <option value="washington">Washington</option>
                        <option value="west-virginia">West Virginia</option>
                        <option value="wisconsin">Wisconsin</option>
                        <option value="wyoming">Wyoming</option>
                        <option value="washington-dc">Washington DC</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="stateSearch" class="form-label fw-bold">
                        <i class="fas fa-search me-2"></i>Or Search
                    </label>
                    <input type="text" class="form-control form-control-lg" id="stateSearch" 
                           placeholder="Type to filter states...">
                </div>
            </div>
        </div>
    </div>

    <!-- States Grid -->
    <div class="row g-4" id="statesContainer">
        <!-- Alabama -->
        <div class="col-md-6 col-lg-4 state-card" data-state="alabama">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Alabama</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Alabama government contracts</p>
                                        <button onclick="findCityRFPs('Alabama', 'AL')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.purchasing.alabama.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://procurement.staars.alabama.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>STAARS Vendor Portal
                    </a>
                </div>
            </div>
        </div>

        <!-- Alaska -->
        <div class="col-md-6 col-lg-4 state-card" data-state="alaska">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Alaska</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Alaska government contracts</p>
                                        <button onclick="findCityRFPs('Alaska', 'AK')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://aws.state.ak.us" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://aws.state.ak.us/OnlinePublicNotices/default.aspx" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>IRIS (Bids)
                    </a>
                </div>
            </div>
        </div>

        <!-- Arizona -->
        <div class="col-md-6 col-lg-4 state-card" data-state="arizona">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Arizona</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Arizona government contracts</p>
                                        <button onclick="findCityRFPs('Arizona', 'AZ')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://spo.az.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://spo.az.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>SPO Resources
                    </a>
                </div>
            </div>
        </div>

        <!-- Arkansas -->
        <div class="col-md-6 col-lg-4 state-card" data-state="arkansas">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Arkansas</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Arkansas government contracts</p>
                                        <button onclick="findCityRFPs('Arkansas', 'AR')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.dfa.arkansas.gov/procurement/" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>DFA Procurement
                    </a>
                    <a href="https://www.dfa.arkansas.gov/procurement/vendor-information/" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Vendor Information
                    </a>
                </div>
            </div>
        </div>

        <!-- California -->
        <div class="col-md-6 col-lg-4 state-card" data-state="california">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>California</h5>
                </div>
                <div class="card-body">
                    <p style="color: #4a5568;" class="small mb-3">State procurement portal for California government contracts</p>
                    <button onclick="findCityRFPs('California', 'CA')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
                    <a href="https://www.dgs.ca.gov/PD" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <button onclick="updateRegistrationStatus('California', 'CA')" class="btn btn-outline-secondary btn-sm w-100">
                        <i class="fas fa-user-check me-2"></i>Track Registration
                    </button>
                </div>
            </div>
        </div>

        <!-- Colorado -->
        <div class="col-md-6 col-lg-4 state-card" data-state="colorado">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Colorado</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Colorado government contracts</p>
                                        <button onclick="findCityRFPs('Colorado', 'CO')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.colorado.gov/dpa/dfp/spo" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://bidscolorado.com" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>BidsColorado
                    </a>
                </div>
            </div>
        </div>

        <!-- Connecticut -->
        <div class="col-md-6 col-lg-4 state-card" data-state="connecticut">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Connecticut</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Connecticut government contracts</p>
                                        <button onclick="findCityRFPs('Connecticut', 'CT')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://portal.ct.gov/DAS/Procurement" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www.biznet.ct.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>BizNet
                    </a>
                </div>
            </div>
        </div>

        <!-- Delaware -->
        <div class="col-md-6 col-lg-4 state-card" data-state="delaware">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Delaware</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Delaware government contracts</p>
                                        <button onclick="findCityRFPs('Delaware', 'DE')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://gss.omb.delaware.gov/" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://bids.delaware.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>DE Bids
                    </a>
                </div>
            </div>
        </div>

        <!-- Florida -->
        <div class="col-md-6 col-lg-4 state-card" data-state="florida">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Florida</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Florida government contracts</p>
                                        <button onclick="findCityRFPs('Florida', 'FL')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<button onclick="showStateDetails('florida')" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-building me-2"></i>View FL Opportunities
                    </button>
                    <a href="https://www.dms.myflorida.com/business_operations/state_purchasing" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-external-link-alt me-2"></i>Official Portal
                    </a>
                </div>
            </div>
        </div>

        <!-- Georgia -->
        <div class="col-md-6 col-lg-4 state-card" data-state="georgia">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Georgia</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Georgia government contracts</p>
                                        <button onclick="findCityRFPs('Georgia', 'GA')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://doas.ga.gov/state-purchasing" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://doas.ga.gov/state-purchasing" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Supplier Resources
                    </a>
                </div>
            </div>
        </div>

        <!-- Hawaii -->
        <div class="col-md-6 col-lg-4 state-card" data-state="hawaii">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Hawaii</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Hawaii government contracts</p>
                                        <button onclick="findCityRFPs('Hawaii', 'HI')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://spo.hawaii.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://hands.ehawaii.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>HANDS (eProcurement)
                    </a>
                </div>
            </div>
        </div>

        <!-- Idaho -->
        <div class="col-md-6 col-lg-4 state-card" data-state="idaho">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Idaho</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Idaho government contracts</p>
                                        <button onclick="findCityRFPs('Idaho', 'ID')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://purchasing.idaho.gov/" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://purchasing.idaho.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>ID Purchasing
                    </a>
                </div>
            </div>
        </div>

        <!-- Illinois -->
        <div class="col-md-6 col-lg-4 state-card" data-state="illinois">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Illinois</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Illinois government contracts</p>
                                        <button onclick="findCityRFPs('Illinois', 'IL')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www2.illinois.gov/cms/business/sell2/Pages/default.aspx" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www2.illinois.gov/cms/business/buy/Pages/bids.aspx" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Illinois Bids
                    </a>
                </div>
            </div>
        </div>

        <!-- Indiana -->
        <div class="col-md-6 col-lg-4 state-card" data-state="indiana">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Indiana</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Indiana government contracts</p>
                                        <button onclick="findCityRFPs('Indiana', 'IN')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.in.gov/idoa/procurement/" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://fs.gmis.in.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>GMIS (Bids)
                    </a>
                </div>
            </div>
        </div>

        <!-- Iowa -->
        <div class="col-md-6 col-lg-4 state-card" data-state="iowa">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Iowa</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Iowa government contracts</p>
                                        <button onclick="findCityRFPs('Iowa', 'IA')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://das.iowa.gov/procurement" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://bidopportunities.iowa.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Bid Opportunities
                    </a>
                </div>
            </div>
        </div>

        <!-- Kansas -->
        <div class="col-md-6 col-lg-4 state-card" data-state="kansas">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Kansas</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Kansas government contracts</p>
                                        <button onclick="findCityRFPs('Kansas', 'KS')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://admin.ks.gov/offices/procurement-and-contracts" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://admin.ks.gov/offices/procurement-and-contracts" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Vendor Resources
                    </a>
                </div>
            </div>
        </div>

        <!-- Kentucky -->
        <div class="col-md-6 col-lg-4 state-card" data-state="kentucky">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Kentucky</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Kentucky government contracts</p>
                                        <button onclick="findCityRFPs('Kentucky', 'KY')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://eprocurement.ky.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>eProcurement Portal
                    </a>
                    <a href="#" class="btn btn-outline-primary btn-sm w-100 disabled" aria-disabled="true">
                        <i class="fas fa-file-contract me-2"></i>Vendor Marketplace (Updating)
                    </a>
                </div>
            </div>
        </div>

        <!-- Louisiana -->
        <div class="col-md-6 col-lg-4 state-card" data-state="louisiana">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Louisiana</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Louisiana government contracts</p>
                                        <button onclick="findCityRFPs('Louisiana', 'LA')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://wwwcfprd.doa.louisiana.gov/osp/lapac/pubMain.cfm" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www.doa.la.gov/doa/osp/" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>LA Purchasing
                    </a>
                </div>
            </div>
        </div>

        <!-- Maine -->
        <div class="col-md-6 col-lg-4 state-card" data-state="maine">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Maine</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Maine government contracts</p>
                                        <button onclick="findCityRFPs('Maine', 'ME')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.maine.gov/dafs/bbm/procurementservices" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www.maine.gov/dafs/procurementservices" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Procurement Services
                    </a>
                </div>
            </div>
        </div>

        <!-- Maryland -->
        <div class="col-md-6 col-lg-4 state-card" data-state="maryland">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Maryland</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Maryland government contracts</p>
                                        <button onclick="findCityRFPs('Maryland', 'MD')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://procurement.maryland.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://emma.maryland.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>EMMA Vendor Portal
                    </a>
                </div>
            </div>
        </div>

        <!-- Massachusetts -->
        <div class="col-md-6 col-lg-4 state-card" data-state="massachusetts">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Massachusetts</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Massachusetts government contracts</p>
                                        <button onclick="findCityRFPs('Massachusetts', 'MA')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.mass.gov/orgs/operational-services-division" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www.commbuys.com" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>COMMBUYS
                    </a>
                </div>
            </div>
        </div>

        <!-- Michigan -->
        <div class="col-md-6 col-lg-4 state-card" data-state="michigan">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Michigan</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Michigan government contracts</p>
                                        <button onclick="findCityRFPs('Michigan', 'MI')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.michigan.gov/sigmavss" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>SIGMA VSS Portal
                    </a>
                    <a href="https://www.michigan.gov/sigmavss/0,4672,7-102-1631_9350---,00.html" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Bid Opportunities
                    </a>
                </div>
            </div>
        </div>

        <!-- Minnesota -->
        <div class="col-md-6 col-lg-4 state-card" data-state="minnesota">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Minnesota</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Minnesota government contracts</p>
                                        <button onclick="findCityRFPs('Minnesota', 'MN')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://mn.gov/admin/osp/" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://mn.gov/admin/osp/government/bidding/" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>MN Bidding
                    </a>
                </div>
            </div>
        </div>

        <!-- Mississippi -->
        <div class="col-md-6 col-lg-4 state-card" data-state="mississippi">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Mississippi</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Mississippi government contracts</p>
                                        <button onclick="findCityRFPs('Mississippi', 'MS')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.dfa.ms.gov/dfa-offices/mmrs/" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www.mmrs.state.ms.us" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>MMRS (Bids)
                    </a>
                </div>
            </div>
        </div>

        <!-- Missouri -->
        <div class="col-md-6 col-lg-4 state-card" data-state="missouri">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Missouri</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Missouri government contracts</p>
                                        <button onclick="findCityRFPs('Missouri', 'MO')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://oa.mo.gov/purchasing" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://oa.mo.gov/purchasing/vendors" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>MO Buy
                    </a>
                </div>
            </div>
        </div>

        <!-- Montana -->
        <div class="col-md-6 col-lg-4 state-card" data-state="montana">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Montana</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Montana government contracts</p>
                                        <button onclick="findCityRFPs('Montana', 'MT')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://spb.mt.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Procurement Bureau
                    </a>
                    <a href="https://spb.mt.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Current Solicitations
                    </a>
                </div>
            </div>
        </div>

        <!-- Nebraska -->
        <div class="col-md-6 col-lg-4 state-card" data-state="nebraska">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Nebraska</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Nebraska government contracts</p>
                                        <button onclick="findCityRFPs('Nebraska', 'NE')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://das.nebraska.gov/materiel/" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://das.nebraska.gov/materiel/purchasing.html" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>NEGP (Bids)
                    </a>
                </div>
            </div>
        </div>

        <!-- Nevada -->
        <div class="col-md-6 col-lg-4 state-card" data-state="nevada">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Nevada</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Nevada government contracts</p>
                                        <button onclick="findCityRFPs('Nevada', 'NV')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.nevadaepro.com" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www.nevadaepro.com" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>NV ePro
                    </a>
                </div>
            </div>
        </div>

        <!-- New Hampshire -->
        <div class="col-md-6 col-lg-4 state-card" data-state="new-hampshire">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>New Hampshire</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for New Hampshire government contracts</p>
                                        <button onclick="findCityRFPs('New Hampshire', 'NH')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://das.nh.gov/purchasing/" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://das.nh.gov/purchasing/Notices_of_Solicitation_and_Posting_of_Results.aspx" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>NH Solicitations
                    </a>
                </div>
            </div>
        </div>

        <!-- New Jersey -->
        <div class="col-md-6 col-lg-4 state-card" data-state="new-jersey">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>New Jersey</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for New Jersey government contracts</p>
                                        <button onclick="findCityRFPs('New Jersey', 'NJ')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.njstart.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www.nj.gov/treasury/purchase/" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>NJ Purchasing
                    </a>
                </div>
            </div>
        </div>

        <!-- New Mexico -->
        <div class="col-md-6 col-lg-4 state-card" data-state="new-mexico">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>New Mexico</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for New Mexico government contracts</p>
                                        <button onclick="findCityRFPs('New Mexico', 'NM')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.generalservices.state.nm.us/state-purchasing/" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www.nmspo.com" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>NM SPO
                    </a>
                </div>
            </div>
        </div>

        <!-- New York -->
        <div class="col-md-6 col-lg-4 state-card" data-state="new-york">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>New York</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for New York government contracts</p>
                                        <button onclick="findCityRFPs('New York', 'NY')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<button onclick="showStateDetails('new-york')" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-building me-2"></i>View NY Opportunities
                    </button>
                    <a href="https://ogs.ny.gov/procurement" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-external-link-alt me-2"></i>Official Portal
                    </a>
                </div>
            </div>
        </div>

        <!-- North Carolina -->
        <div class="col-md-6 col-lg-4 state-card" data-state="north-carolina">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>North Carolina</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for North Carolina government contracts</p>
                                        <button onclick="findCityRFPs('North Carolina', 'NC')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.pandc.nc.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://eprocurement.nc.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>NC eProcurement
                    </a>
                </div>
            </div>
        </div>

        <!-- North Dakota -->
        <div class="col-md-6 col-lg-4 state-card" data-state="north-dakota">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>North Dakota</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for North Dakota government contracts</p>
                                        <button onclick="findCityRFPs('North Dakota', 'ND')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.nd.gov/omb/procurement" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www.nd.gov/omb/procurement" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Current Opportunities
                    </a>
                </div>
            </div>
        </div>

        <!-- Ohio -->
        <div class="col-md-6 col-lg-4 state-card" data-state="ohio">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Ohio</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Ohio government contracts</p>
                                        <button onclick="findCityRFPs('Ohio', 'OH')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://ohiobuys.ohio.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>OhioBuys Portal
                    </a>
                    <a href="https://ohio.diversitysoftware.com" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>OH Bids
                    </a>
                </div>
            </div>
        </div>

        <!-- Oklahoma -->
        <div class="col-md-6 col-lg-4 state-card" data-state="oklahoma">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Oklahoma</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Oklahoma government contracts</p>
                                        <button onclick="findCityRFPs('Oklahoma', 'OK')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://oklahoma.gov/omes/services/purchasing.html" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://omes.ok.gov/services/central-purchasing" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Central Purchasing
                    </a>
                </div>
            </div>
        </div>

        <!-- Oregon -->
        <div class="col-md-6 col-lg-4 state-card" data-state="oregon">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Oregon</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Oregon government contracts</p>
                                        <button onclick="findCityRFPs('Oregon', 'OR')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.oregon.gov/das/procurement/pages/index.aspx" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://orpin.oregon.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>ORPIN (Bids)
                    </a>
                </div>
            </div>
        </div>

        <!-- Pennsylvania -->
        <div class="col-md-6 col-lg-4 state-card" data-state="pennsylvania">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Pennsylvania</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Pennsylvania government contracts</p>
                                        <button onclick="findCityRFPs('Pennsylvania', 'PA')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.dgs.pa.gov/Businesses-Vendors/Pages/default.aspx" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www.emarketplace.state.pa.us" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>eMarketplace
                    </a>
                </div>
            </div>
        </div>

        <!-- Rhode Island -->
        <div class="col-md-6 col-lg-4 state-card" data-state="rhode-island">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Rhode Island</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Rhode Island government contracts</p>
                                        <button onclick="findCityRFPs('Rhode Island', 'RI')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.ridop.ri.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www.purchasing.ri.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>RI Purchasing
                    </a>
                </div>
            </div>
        </div>

        <!-- South Carolina -->
        <div class="col-md-6 col-lg-4 state-card" data-state="south-carolina">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>South Carolina</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for South Carolina government contracts</p>
                                        <button onclick="findCityRFPs('South Carolina', 'SC')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://procurement.sc.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://procurement.sc.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Current Opportunities
                    </a>
                </div>
            </div>
        </div>

        <!-- South Dakota -->
        <div class="col-md-6 col-lg-4 state-card" data-state="south-dakota">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>South Dakota</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for South Dakota government contracts</p>
                                        <button onclick="findCityRFPs('South Dakota', 'SD')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://boa.sd.gov/procurement-management/" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://boa.sd.gov/procurement-management/" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Bid Opportunities
                    </a>
                </div>
            </div>
        </div>

        <!-- Tennessee -->
        <div class="col-md-6 col-lg-4 state-card" data-state="tennessee">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Tennessee</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Tennessee government contracts</p>
                                        <button onclick="findCityRFPs('Tennessee', 'TN')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.tn.gov/generalservices/procurement.html" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://www.tn.gov/generalservices/procurement/central-procurement-office--cpo-.html" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Open Solicitations
                    </a>
                </div>
            </div>
        </div>

        <!-- Texas -->
        <div class="col-md-6 col-lg-4 state-card" data-state="texas">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Texas</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Texas government contracts</p>
                                        <button onclick="findCityRFPs('Texas', 'TX')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<button onclick="showStateDetails('texas')" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-building me-2"></i>View TX Opportunities
                    </button>
                    <a href="https://comptroller.texas.gov/purchasing/" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-external-link-alt me-2"></i>Official Portal
                    </a>
                </div>
            </div>
        </div>

        <!-- Utah -->
        <div class="col-md-6 col-lg-4 state-card" data-state="utah">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Utah</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Utah government contracts</p>
                                        <button onclick="findCityRFPs('Utah', 'UT')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://purchasing.utah.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>State Portal
                    </a>
                    <a href="https://transparent.utah.gov/openbids.php" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>UT Open Bids
                    </a>
                </div>
            </div>
        </div>

        <!-- Vermont -->
        <div class="col-md-6 col-lg-4 state-card" data-state="vermont">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Vermont</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Vermont government contracts</p>
                                        <button onclick="findCityRFPs('Vermont', 'VT')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.vermontbusinessregistry.com/BidSearch.aspx" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>Bid Search Portal
                    </a>
                    <a href="https://www.vermontbusinessregistry.com/BidSearch.aspx" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Current Bids
                    </a>
                </div>
            </div>
        </div>

        <!-- Virginia -->
        <div class="col-md-6 col-lg-4 state-card" data-state="virginia">
            <div class="card h-100 shadow-sm hover-lift border-success" style="border-width: 3px !important;">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-star me-2"></i>Virginia</h5>
                </div>
                <div class="card-body">
                    <p style="color: #4a5568;" class="small mb-3"><strong>Your State!</strong> Virginia procurement portal for state government contracts</p>
                    <button onclick="findCityRFPs('Virginia', 'VA')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
                    <a href="https://eva.virginia.gov" target="_blank" class="btn btn-outline-success btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>Official eVA Portal
                    </a>
                    <button onclick="updateRegistrationStatus('Virginia', 'VA')" class="btn btn-outline-secondary btn-sm w-100">
                        <i class="fas fa-user-check me-2"></i>Track Registration
                    </button>
                </div>
            </div>
        </div>

        <!-- Washington -->
        <div class="col-md-6 col-lg-4 state-card" data-state="washington">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Washington</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Washington government contracts</p>
                                        <button onclick="findCityRFPs('Washington', 'WA')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://pr-webs-vendor.des.wa.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>WEBS Vendor Portal
                    </a>
                    <a href="https://pr-webs-vendor.des.wa.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Current Opportunities
                    </a>
                </div>
            </div>
        </div>

        <!-- Washington DC -->
        <div class="col-md-6 col-lg-4 state-card" data-state="washington-dc">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Washington DC</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">Procurement portal for Washington DC government contracts</p>
                                        <button onclick="findCityRFPs('Washington DC', 'DC')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://ocp.dc.gov" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>DC Portal
                    </a>
                    <a href="https://ocp.dc.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>Open Solicitations
                    </a>
                </div>
            </div>
        </div>

        <!-- West Virginia -->
        <div class="col-md-6 col-lg-4 state-card" data-state="west-virginia">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>West Virginia</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for West Virginia government contracts</p>
                                        <button onclick="findCityRFPs('West Virginia', 'WV')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://www.state.wv.us/admin/purchase/" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>WV Purchasing Division
                    </a>
                    <a href="https://wvOasis.gov" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-file-contract me-2"></i>OASIS Vendor Portal
                    </a>
                </div>
            </div>
        </div>

        <!-- Wisconsin -->
        <div class="col-md-6 col-lg-4 state-card" data-state="wisconsin">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Wisconsin</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Wisconsin government contracts</p>
                                        <button onclick="findCityRFPs('Wisconsin', 'WI')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="https://vendornet.state.wi.us" target="_blank" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-external-link-alt me-2"></i>VendorNet Portal
                    </a>
                    <a href="#" class="btn btn-outline-primary btn-sm w-100 disabled" aria-disabled="true">
                        <i class="fas fa-file-contract me-2"></i>VSS (Retired)
                    </a>
                </div>
            </div>
        </div>

        <!-- Wyoming -->
        <div class="col-md-6 col-lg-4 state-card" data-state="wyoming">
            <div class="card h-100 shadow-sm hover-lift">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-landmark me-2"></i>Wyoming</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">State procurement portal for Wyoming government contracts</p>
                                        <button onclick="findCityRFPs('Wyoming', 'WY')" class="btn btn-success btn-sm w-100 mb-2">
                        <i class="fas fa-robot me-2"></i>Find City RFPs (AI)
                    </button>
<a href="#" class="btn btn-primary btn-sm w-100 mb-2 disabled" aria-disabled="true">
                        <i class="fas fa-external-link-alt me-2"></i>Portal Updating
                    </a>
                    <a href="#" class="btn btn-outline-primary btn-sm w-100 disabled" aria-disabled="true">
                        <i class="fas fa-file-contract me-2"></i>Coming Soon
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- State Details Modal -->
<div class="modal fade" id="stateDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h4 class="modal-title">
                    <i class="fas fa-landmark me-2"></i><span id="modalStateName"></span> Opportunities
                </h4>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Cities & Localities -->
                <div class="mb-4">
                    <h5 class="mb-3"><i class="fas fa-map-marked-alt me-2 text-primary"></i>Major Cities & Localities</h5>
                    <div id="modalCities" class="row g-2"></div>
                </div>

                <!-- Active Opportunities -->
                <div>
                    <h5 class="mb-3"><i class="fas fa-file-contract me-2 text-success"></i>Active Contract Opportunities</h5>
                    <div id="modalOpportunities"></div>
                </div>

                <!-- No Data Message -->
                <div id="noDataMessage" class="text-center py-5 d-none">
                    <i class="fas fa-info-circle fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">Coming Soon</h5>
                    <p>Opportunities for this state are being added. Check the official portal link for current bids.</p>
                </div>
            </div>
            <div class="modal-footer">
                <a id="modalOfficialLink" href="#" target="_blank" class="btn btn-primary">
                    <i class="fas fa-external-link-alt me-2"></i>Visit Official State Portal
                </a>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<style>
.hover-lift {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.hover-lift:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.15) !important;
}

.state-card.hidden {
    display: none !important;
}

/* Improved text contrast */
.card-body .text-muted {
    color: #2c3e50 !important;
    font-weight: 500;
}

.card-header h5 {
    color: #ffffff !important;
    font-weight: 700;
}

.city-badge {
    transition: all 0.2s ease;
    cursor: pointer;
}

.city-badge:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.opportunity-card {
    transition: all 0.2s ease;
}

.opportunity-card:hover {
    background-color: #f8f9fa;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
</style>

<script>
// Global state registration data
let userRegistrations = {};

// Load user registration status on page load
document.addEventListener('DOMContentLoaded', function() {
    loadRegistrationStatus();
});

// Load registration status from backend
function loadRegistrationStatus() {
    fetch('/api/portal-registration-status')
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                userRegistrations = data.registrations;
                updateCardColors();
            }
        })
        .catch(err => console.error('Error loading registration status:', err));
}

// Update card colors based on registration status
function updateCardColors() {
    document.querySelectorAll('.state-card').forEach(card => {
        const stateName = card.getAttribute('data-state');
        const stateCode = stateName.substring(0, 2).toUpperCase();
        const registration = userRegistrations[stateCode];
        
        const cardHeader = card.querySelector('.card-header');
        
        if (registration) {
            if (registration.status === 'registered') {
                // Green - Registered
                cardHeader.classList.remove('bg-primary', 'bg-warning', 'bg-secondary');
                cardHeader.classList.add('bg-success');
                card.querySelector('.card').style.borderLeft = '5px solid #28a745';
            } else if (registration.status === 'in_progress') {
                // Yellow - In Progress
                cardHeader.classList.remove('bg-primary', 'bg-success', 'bg-secondary');
                cardHeader.classList.add('bg-warning');
                cardHeader.classList.add('text-dark');
                cardHeader.querySelector('h5').classList.remove('text-white');
                card.querySelector('.card').style.borderLeft = '5px solid #ffc107';
            } else {
                // Gray - Not Started
                cardHeader.classList.remove('bg-primary', 'bg-success', 'bg-warning');
                cardHeader.classList.add('bg-secondary');
                card.querySelector('.card').style.borderLeft = '5px solid #6c757d';
            }
        } else {
            // Default - No registration data
            cardHeader.classList.remove('bg-success', 'bg-warning', 'bg-secondary');
            cardHeader.classList.add('bg-primary');
            card.querySelector('.card').style.borderLeft = 'none';
        }
    });
}

// Find City RFPs using AI
function findCityRFPs(stateName, stateCode) {
    // Show loading modal
    const loadingHtml = `
        <div class="modal fade" id="cityRfpModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">
                            <i class="fas fa-robot me-2"></i>AI City RFP Finder - ${stateName}
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body text-center py-5">
                        <div class="spinner-border text-primary mb-3" style="width: 4rem; height: 4rem;"></div>
                        <h5> AI is searching for local city RFPs...</h5>
                        <p class="text-muted">Scanning top 3 cities and procurement portals</p>
                        <p class="small">This may take 30-45 seconds</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if any
    const existingModal = document.getElementById('cityRfpModal');
    if (existingModal) existingModal.remove();
    
    document.body.insertAdjacentHTML('beforeend', loadingHtml);
    const modal = new bootstrap.Modal(document.getElementById('cityRfpModal'));
    modal.show();
    
    // Call AI endpoint with extended timeout (90 seconds)
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 90000);
    
    fetch('/api/find-city-rfps', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            state_name: stateName,
            state_code: stateCode
        }),
        signal: controller.signal
    })
    .then(r => {
        clearTimeout(timeoutId);
        if (!r.ok) {
            throw new Error(`HTTP ${r.status}: ${r.statusText}`);
        }
        return r.json();
    })
    .then(data => {
        if (data.success) {
            displayCityRFPs(data.rfps, stateName, data.message, data.cities_checked);
        } else {
            displayError(data.error || 'Failed to find city RFPs');
        }
    })
    .catch(err => {
        clearTimeout(timeoutId);
        console.error('City RFP error:', err);
        if (err.name === 'AbortError') {
            displayError('Request timeout (90s). The AI is still processing - results may appear in your account shortly. Try refreshing the page.');
        } else {
            displayError(`Network error: ${err.message}. Please check your connection and try again.`);
        }
    });
}

// Display found city RFPs in modal
function displayCityRFPs(rfps, stateName, message, citiesChecked) {
    let rfpsHtml = '';
    
    if (rfps && rfps.length > 0) {
        rfpsHtml = rfps.map(rfp => `
            <div class="card mb-3 border-start border-success border-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h6 class="mb-0">
                            <i class="fas fa-building text-primary me-2"></i>${rfp.city_name}
                        </h6>
                        ${rfp.estimated_value ? `<span class="badge bg-success">${rfp.estimated_value}</span>` : ''}
                    </div>
                    <h5 class="mb-2">${rfp.rfp_title}</h5>
                    ${rfp.rfp_number ? `<p class="text-muted small mb-2"><strong>RFP #:</strong> ${rfp.rfp_number}</p>` : ''}
                    ${rfp.description ? `<p class="mb-2">${rfp.description}</p>` : ''}
                    <div class="row g-2 small">
                        ${rfp.department ? `<div class="col-md-6"><i class="fas fa-sitemap me-1"></i> <strong>Dept:</strong> ${rfp.department}</div>` : ''}
                        ${rfp.deadline ? `<div class="col-md-6"><i class="fas fa-calendar me-1"></i> <strong>Deadline:</strong> ${rfp.deadline}</div>` : ''}
                        ${rfp.contact_email ? `<div class="col-md-6"><i class="fas fa-envelope me-1"></i> ${rfp.contact_email}</div>` : ''}
                        ${rfp.contact_phone ? `<div class="col-md-6"><i class="fas fa-phone me-1"></i> ${rfp.contact_phone}</div>` : ''}
                    </div>
                </div>
            </div>
        `).join('');
    } else {
        // Show which cities were checked
        const citiesList = citiesChecked && citiesChecked.length > 0 
            ? citiesChecked.map(c => `<span class="badge bg-light text-dark me-1 mb-1">${c}</span>`).join('')
            : '';
        
        rfpsHtml = `
            <div class="alert alert-warning">
                <h6><i class="fas fa-info-circle me-2"></i>No Active RFPs Found</h6>
                <p class="mb-2">Our AI checked major cities but didn't find active cleaning/janitorial RFPs at this time.</p>
                ${citiesList ? `<p class="mb-2"><strong>Cities Checked:</strong><br>${citiesList}</p>` : ''}
                <hr>
                <p class="mb-0 small"><strong>Suggestions:</strong></p>
                <ul class="small mb-0">
                    <li>Check the official state portal directly (button below)</li>
                    <li>Try again in a few days - RFPs are posted regularly</li>
                    <li>Consider registering on the state's vendor portal for notifications</li>
                    <li>Contact city procurement offices directly for upcoming opportunities</li>
                </ul>
            </div>
        `;
    }
    
    const successHtml = `
        <div class="modal-header bg-success text-white">
            <h5 class="modal-title">
                <i class="fas fa-check-circle me-2"></i>City RFPs Found - ${stateName}
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
            <div class="alert alert-success mb-3">
                <strong> ${message}</strong>
            </div>
            <div style="max-height: 500px; overflow-y: auto;">
                ${rfpsHtml}
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
    `;
    
    document.querySelector('#cityRfpModal .modal-content').innerHTML = successHtml;
}

// Display error in modal
function displayError(errorMsg) {
    const errorHtml = `
        <div class="modal-header bg-danger text-white">
            <h5 class="modal-title">
                <i class="fas fa-exclamation-triangle me-2"></i>Error
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
            <div class="alert alert-danger mb-0">
                <i class="fas fa-exclamation-circle me-2"></i>${errorMsg}
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
    `;
    
    document.querySelector('#cityRfpModal .modal-content').innerHTML = errorHtml;
}

// Update registration status
function updateRegistrationStatus(stateName, stateCode, newStatus) {
    const modal = new bootstrap.Modal(document.getElementById('registrationModal'));
    document.getElementById('regStateName').textContent = stateName;
    document.getElementById('regStateCode').value = stateCode;
    document.getElementById('regStateNameInput').value = stateName;
    document.getElementById('regStatus').value = newStatus || 'not_started';
    modal.show();
}

// Save registration status
function saveRegistrationStatus() {
    const stateCode = document.getElementById('regStateCode').value;
    const stateName = document.getElementById('regStateNameInput').value;
    const status = document.getElementById('regStatus').value;
    const vendorId = document.getElementById('regVendorId').value;
    const notes = document.getElementById('regNotes').value;
    
    fetch('/api/portal-registration-status', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            state_code: stateCode,
            state_name: stateName,
            status: status,
            vendor_id: vendorId,
            notes: notes
        })
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            alert(` Registration status updated for ${stateName}`);
            loadRegistrationStatus(); // Reload and update colors
            bootstrap.Modal.getInstance(document.getElementById('registrationModal')).hide();
        } else {
            alert(' Error: ' + data.error);
        }
    })
    .catch(err => alert('Network error. Please try again.'));
}

// Scroll to selected state from dropdown
function scrollToState(stateValue) {
    if (!stateValue) return;
    
    const stateCard = document.querySelector(`.state-card[data-state="${stateValue}"]`);
    if (stateCard) {
        // Clear search filter first
        document.getElementById('stateSearch').value = '';
        document.querySelectorAll('.state-card').forEach(card => card.classList.remove('hidden'));
        
        // Highlight and scroll
        stateCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // Flash effect
        stateCard.style.transition = 'all 0.3s ease';
        stateCard.style.transform = 'scale(1.05)';
        stateCard.style.boxShadow = '0 0 20px rgba(102, 126, 234, 0.6)';
        
        setTimeout(() => {
            stateCard.style.transform = 'scale(1)';
            stateCard.style.boxShadow = '';
        }, 800);
    }
}

// Search functionality
document.getElementById('stateSearch').addEventListener('keyup', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const stateCards = document.querySelectorAll('.state-card');
    
    // Clear dropdown selection when typing
    if (searchTerm) {
        document.getElementById('stateDropdown').value = '';
    }
    
    stateCards.forEach(card => {
        const stateName = card.getAttribute('data-state');
        if (stateName.includes(searchTerm) || searchTerm === '') {
            card.classList.remove('hidden');
        } else {
            card.classList.add('hidden');
        }
    });
});

// State data with cities and opportunities
const stateData = {
    virginia: {
        name: 'Virginia',
        officialLink: 'https://eva.virginia.gov',
        cities: [
            'Richmond', 'Virginia Beach', 'Norfolk', 'Chesapeake', 'Arlington',
            'Newport News', 'Hampton', 'Alexandria', 'Roanoke', 'Suffolk',
            'Portsmouth', 'Fairfax', 'Lynchburg', 'Williamsburg', 'Charlottesville'
        ],
        opportunities: [
            {
                title: 'Janitorial Services - State Office Buildings',
                agency: 'Virginia Department of General Services',
                value: '$450,000',
                deadline: 'Dec 15, 2025',
                location: 'Richmond, VA',
                type: 'Janitorial Services'
            },
            {
                title: 'Cleaning & Maintenance - Hampton Roads',
                agency: 'Hampton Roads Transit',
                value: '$280,000',
                deadline: 'Dec 20, 2025',
                location: 'Norfolk, VA',
                type: 'Facility Maintenance'
            },
            {
                title: 'School Custodial Services',
                agency: 'Virginia Beach City Public Schools',
                value: '$1,200,000',
                deadline: 'Jan 10, 2026',
                location: 'Virginia Beach, VA',
                type: 'Educational Facilities'
            },
            {
                title: 'Hospital Environmental Services',
                agency: 'Virginia Department of Health',
                value: '$850,000',
                deadline: 'Dec 28, 2025',
                location: 'Richmond, VA',
                type: 'Healthcare Facilities'
            }
        ]
    },
    california: {
        name: 'California',
        officialLink: 'https://www.dgs.ca.gov/PD/Opportunities',
        cities: [
            'Los Angeles', 'San Diego', 'San Francisco', 'Sacramento', 'San Jose',
            'Fresno', 'Oakland', 'Long Beach', 'Anaheim', 'Riverside'
        ],
        opportunities: [
            {
                title: 'State Building Janitorial Services',
                agency: 'California Department of General Services',
                value: '$2,500,000',
                deadline: 'Dec 18, 2025',
                location: 'Sacramento, CA',
                type: 'Government Buildings'
            },
            {
                title: 'University Facilities Cleaning',
                agency: 'UC System',
                value: '$1,800,000',
                deadline: 'Jan 5, 2026',
                location: 'Multiple Locations',
                type: 'Educational Facilities'
            }
        ]
    },
    texas: {
        name: 'Texas',
        officialLink: 'https://comptroller.texas.gov/purchasing/',
        cities: [
            'Houston', 'San Antonio', 'Dallas', 'Austin', 'Fort Worth',
            'El Paso', 'Arlington', 'Corpus Christi', 'Plano', 'Lubbock'
        ],
        opportunities: [
            {
                title: 'Capitol Complex Janitorial Services',
                agency: 'Texas Facilities Commission',
                value: '$3,200,000',
                deadline: 'Dec 22, 2025',
                location: 'Austin, TX',
                type: 'Government Buildings'
            },
            {
                title: 'School District Custodial Services',
                agency: 'Houston ISD',
                value: '$4,500,000',
                deadline: 'Jan 15, 2026',
                location: 'Houston, TX',
                type: 'Educational Facilities'
            }
        ]
    },
    florida: {
        name: 'Florida',
        officialLink: 'https://www.dms.myflorida.com/business_operations/state_purchasing',
        cities: [
            'Jacksonville', 'Miami', 'Tampa', 'Orlando', 'St. Petersburg',
            'Tallahassee', 'Fort Lauderdale', 'Cape Coral', 'Pembroke Pines', 'Port St. Lucie'
        ],
        opportunities: [
            {
                title: 'State Facilities Cleaning Services',
                agency: 'Florida Department of Management Services',
                value: '$1,900,000',
                deadline: 'Dec 30, 2025',
                location: 'Tallahassee, FL',
                type: 'Government Buildings'
            }
        ]
    },
    'new-york': {
        name: 'New York',
        officialLink: 'https://www.ogs.ny.gov/procurement',
        cities: [
            'New York City', 'Buffalo', 'Rochester', 'Syracuse', 'Albany',
            'Yonkers', 'New Rochelle', 'Mount Vernon', 'Schenectady', 'Utica'
        ],
        opportunities: [
            {
                title: 'Office Building Janitorial Services',
                agency: 'NY Office of General Services',
                value: '$5,200,000',
                deadline: 'Jan 8, 2026',
                location: 'Albany, NY',
                type: 'Government Buildings'
            }
        ]
    }
};

// Show state details in modal
function showStateDetails(stateKey) {
    const data = stateData[stateKey];
    
    if (!data) {
        // Show generic message for states without data
        document.getElementById('modalStateName').textContent = stateKey.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
        document.getElementById('modalCities').innerHTML = '';
        document.getElementById('modalOpportunities').innerHTML = '';
        document.getElementById('noDataMessage').classList.remove('d-none');
        document.getElementById('modalOfficialLink').href = '#';
    } else {
        // Populate modal with state data
        document.getElementById('modalStateName').textContent = data.name;
        document.getElementById('noDataMessage').classList.add('d-none');
        document.getElementById('modalOfficialLink').href = data.officialLink;
        
        // Populate cities
        const citiesHtml = data.cities.map(city => `
            <div class="col-md-3 col-sm-4 col-6">
                <span class="badge bg-light text-dark city-badge w-100 p-2 mb-2">
                    <i class="fas fa-map-marker-alt me-1 text-primary"></i>${city}
                </span>
            </div>
        `).join('');
        document.getElementById('modalCities').innerHTML = citiesHtml;
        
        // Populate opportunities
        const oppsHtml = data.opportunities.map(opp => `
            <div class="card opportunity-card mb-3 border">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h6 class="mb-2">
                                <i class="fas fa-file-contract text-success me-2"></i>${opp.title}
                            </h6>
                            <p class="text-muted small mb-2">
                                <strong>Agency:</strong> ${opp.agency}
                            </p>
                            <p class="text-muted small mb-0">
                                <i class="fas fa-map-marker-alt me-1"></i>${opp.location}
                                <span class="ms-3"><i class="fas fa-tag me-1"></i>${opp.type}</span>
                            </p>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <div class="mb-2">
                                <span class="badge bg-success fs-6">${opp.value}</span>
                            </div>
                            <div class="mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-calendar me-1"></i>Due: ${opp.deadline}
                                </small>
                            </div>
                            <a href="${data.officialLink}" target="_blank" class="btn btn-sm btn-primary">
                                <i class="fas fa-external-link-alt me-1"></i>View Bid
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
        document.getElementById('modalOpportunities').innerHTML = oppsHtml;
    }
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('stateDetailsModal'));
    modal.show();
}
</script>

<!-- Registration Status Modal -->
<div class="modal fade" id="registrationModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-user-check me-2"></i>Track Portal Registration - <span id="regStateName"></span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="regStateCode">
                <input type="hidden" id="regStateNameInput">
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Registration Status</label>
                    <select class="form-select" id="regStatus">
                        <option value="not_started">Not Started</option>
                        <option value="in_progress">In Progress</option>
                        <option value="registered"> Registered</option>
                    </select>
                    <small style="color: #4a5568;">Card color: Gray (Not Started), Yellow (In Progress), Green (Registered)</small>
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Vendor ID (Optional)</label>
                    <input type="text" class="form-control" id="regVendorId" placeholder="Your vendor/supplier ID for this portal">
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Notes</label>
                    <textarea class="form-control" id="regNotes" rows="3" placeholder="Registration date, contact person, next steps, etc."></textarea>
                </div>
                
                <div class="alert alert-info small mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Tracking your registration status helps you stay organized across all 50 states. Card colors update automatically!
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" onclick="saveRegistrationStatus()">
                    <i class="fas fa-save me-2"></i>Save Status
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

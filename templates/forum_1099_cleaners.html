{% extends "base.html" %}

{% block title %}1099 Cleaners Needed - Community Forum{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- Hero Header -->
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold text-primary mb-3">
            <i class="fas fa-users me-2"></i>1099 Cleaners Needed
        </h1>
        <p class="lead text-muted">
            Find independent contractor cleaning opportunities from verified companies
        </p>
        <div class="d-flex justify-content-center gap-3 mb-4">
            <span class="badge bg-success fs-6 px-3 py-2">
                <i class="fas fa-check-circle me-2"></i>{{ posts|length }} Active Listings
            </span>
            <span class="badge bg-info fs-6 px-3 py-2">
                <i class="fas fa-map-marker-alt me-2"></i>{{ states_count }} States
            </span>
        </div>
    </div>

    <!-- Search and Filters -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <form method="GET" action="/forum/1099-cleaners" class="row g-3">
                <div class="col-md-3">
                    <label for="stateFilter" class="form-label fw-bold">State</label>
                    <select class="form-select" id="stateFilter" name="state" onchange="this.form.submit()">
                        <option value="">All States</option>
                        {% for state in states %}
                        <option value="{{ state }}" {% if state_filter == state %}selected{% endif %}>{{ state }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="categoryFilter" class="form-label fw-bold">Service Category</label>
                    <select class="form-select" id="categoryFilter" name="category" onchange="this.form.submit()">
                        <option value="">All Categories</option>
                        {% for cat in categories %}
                        <option value="{{ cat }}" {% if category_filter == cat %}selected{% endif %}>{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="urgencyFilter" class="form-label fw-bold">Urgency</label>
                    <select class="form-select" id="urgencyFilter" name="urgency" onchange="this.form.submit()">
                        <option value="">All Urgencies</option>
                        <option value="urgent" {% if urgency_filter == 'urgent' %}selected{% endif %}>游댮 Urgent</option>
                        <option value="high" {% if urgency_filter == 'high' %}selected{% endif %}>游리 High</option>
                        <option value="normal" {% if urgency_filter == 'normal' %}selected{% endif %}>游릭 Normal</option>
                    </select>
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <a href="/forum/1099-cleaners" class="btn btn-outline-secondary w-100">
                        <i class="fas fa-redo me-2"></i>Clear Filters
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Call-to-Action for Non-Subscribers -->
    {% if not is_subscriber %}
    <div class="alert alert-warning border-warning shadow-sm mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h5 class="mb-2">
                    <i class="fas fa-lock me-2"></i>Unlock Full Contact Details
                </h5>
                <p class="mb-0">
                    Subscribe to view company contact information and apply directly to these opportunities. 
                    Free users can browse but cannot see phone numbers, emails, or company names.
                </p>
            </div>
            <div class="col-md-4 text-end">
                                <a href="/checkout" class="btn btn-warning btn-lg" aria-label="Subscribe now - open unified checkout">
                    <i class="fas fa-crown me-2"></i> Upgrade to Premium - $99/month
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Job Listings -->
    {% if posts|length == 0 %}
    <div class="text-center py-5">
        <i class="fas fa-inbox fa-4x text-muted mb-3"></i>
        <h3 class="text-muted">No Listings Found</h3>
        <p class="text-muted">Try adjusting your filters or check back later</p>
    </div>
    {% else %}
    <div class="row g-4">
        {% for post in posts %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm border-0 hover-lift">
                <div class="card-header text-white py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h5 class="mb-0">{{ post.title }}</h5>
                    <small>Posted {{ post.created_at[:10] }}</small>
                </div>
                <div class="card-body">
                    <!-- Badges -->
                    <div class="mb-3">
                        <span class="badge bg-info me-1">{{ post.service_category }}</span>
                        {% if post.urgency == 'urgent' %}
                        <span class="badge bg-danger">游댮 Urgent</span>
                        {% elif post.urgency == 'high' %}
                        <span class="badge bg-warning text-dark">游리 High Priority</span>
                        {% else %}
                        <span class="badge bg-success">游릭 Normal</span>
                        {% endif %}
                    </div>

                    <!-- Location -->
                    <p class="mb-2">
                        <i class="fas fa-map-marker-alt text-primary me-2"></i>
                        <strong>{{ post.city }}, {{ post.state }}</strong>
                    </p>

                    <!-- Pay Rate -->
                    <p class="mb-2">
                        <i class="fas fa-dollar-sign text-success me-2"></i>
                        <strong>{{ post.pay_rate }}</strong>
                    </p>

                    <!-- Description Preview -->
                    <p class="text-muted small mb-3">
                        {{ post.description[:150] }}{% if post.description|length > 150 %}...{% endif %}
                    </p>

                    <!-- Requirements Icons -->
                    <div class="mb-3">
                        {% if post.background_check_required == 'yes' %}
                        <span class="badge bg-danger me-1" title="Background check required">
                            <i class="fas fa-shield-alt me-1"></i>Background Check
                        </span>
                        {% endif %}
                        {% if post.equipment_required == 'yes' %}
                        <span class="badge bg-success me-1" title="Equipment provided">
                            <i class="fas fa-toolbox me-1"></i>Equipment Provided
                        </span>
                        {% else %}
                        <span class="badge bg-warning text-dark me-1" title="Must provide own equipment">
                            <i class="fas fa-toolbox me-1"></i>BYOE
                        </span>
                        {% endif %}
                    </div>

                    <!-- Contact Info (Subscriber Only) -->
                    {% if is_subscriber %}
                    <div class="border-top pt-3">
                        <p class="mb-1">
                            <strong><i class="fas fa-building me-2"></i>{{ post.company_name }}</strong>
                        </p>
                        <p class="mb-1">
                            <i class="fas fa-envelope me-2"></i>
                            <a href="mailto:{{ post.contact_email }}">{{ post.contact_email }}</a>
                        </p>
                        <p class="mb-0">
                            <i class="fas fa-phone me-2"></i>
                            <a href="tel:{{ post.contact_phone }}">{{ post.contact_phone }}</a>
                        </p>
                    </div>
                    {% else %}
                    <div class="border-top pt-3 text-center">
                        <p class="text-muted small mb-2">
                            <i class="fas fa-lock me-1"></i>Contact details hidden
                        </p>
                                                <a href="/checkout" class="btn btn-sm btn-warning" aria-label="Subscribe now - open unified checkout small">
                            <i class="fas fa-unlock me-1"></i> Subscribe to Contact
                        </a>
                    </div>
                    {% endif %}
                </div>
                <div class="card-footer text-muted small">
                    <i class="fas fa-eye me-1"></i>{{ post.views }} views
                    {% if post.responses > 0 %}
                    <span class="ms-2"><i class="fas fa-comments me-1"></i>{{ post.responses }} responses</span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Post Your Own Job CTA -->
    <div class="card shadow-lg border-0 mt-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="card-body text-white text-center py-5">
            <h3 class="mb-3">Looking to Hire 1099 Cleaners?</h3>
            <p class="lead mb-4">Post your cleaning job for FREE and connect with qualified contractors</p>
            <a href="/request-1099-cleaners" class="btn btn-light btn-lg">
                <i class="fas fa-plus-circle me-2"></i>Post a Job
            </a>
        </div>
    </div>
</div>

<style>
.hover-lift {
    transition: transform 0.2s, box-shadow 0.2s;
}
.hover-lift:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
}
</style>

<script>
// Track view when user clicks on a card
document.querySelectorAll('.card').forEach(card => {
    card.addEventListener('click', function() {
        const postId = this.dataset.postId;
        if (postId) {
            fetch(`/api/forum/1099-cleaners/${postId}/view`, {
                method: 'POST'
            }).catch(err => console.log('View tracking failed:', err));
        }
    });
});
</script>
{% endblock %}

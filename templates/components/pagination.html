{% if pagination %}
<div class="d-flex justify-content-between align-items-center mt-3">
  <div class="text-muted small">
    Showing {{ ((pagination.page - 1) * pagination.per_page) + 1 }}
    - {{ [pagination.page * pagination.per_page, pagination.total]|min }} of
    {{ pagination.total }}
  </div>
  <nav aria-label="Page navigation">
    <ul class="pagination mb-0">
      <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
        <a class="page-link" href="{{ pagination.prev_url or '#' }}" tabindex="-1">Previous</a>
      </li>
      {# Render a compact range of pages #}
      {% set total_pages = pagination.pages %}
      {% set current = pagination.page %}
      {% set start = 1 if total_pages <= 7 else [1, current-2]|max %}
      {% set end = total_pages if total_pages <= 7 else [total_pages, current+2]|min %}

      {% if start > 1 %}
        {% set page_args = request.args.to_dict() %}
        {% set _ = page_args.update({'page': 1, 'per_page': pagination.per_page}) %}
        <li class="page-item"><a class="page-link" href="{{ url_for(request.endpoint, **page_args) }}">1</a></li>
        {% if start > 2 %}
          <li class="page-item disabled"><span class="page-link">…</span></li>
        {% endif %}
      {% endif %}

      {% for p in range(start, end + 1) %}
        {% set page_args = request.args.to_dict() %}
        {% set _ = page_args.update({'page': p, 'per_page': pagination.per_page}) %}
        <li class="page-item {% if p == current %}active{% endif %}">
          <a class="page-link" href="{{ url_for(request.endpoint, **page_args) }}">{{ p }}</a>
        </li>
      {% endfor %}

      {% if end < total_pages %}
        {% if end < total_pages - 1 %}
          <li class="page-item disabled"><span class="page-link">…</span></li>
        {% endif %}
        {% set page_args = request.args.to_dict() %}
        {% set _ = page_args.update({'page': total_pages, 'per_page': pagination.per_page}) %}
        <li class="page-item"><a class="page-link" href="{{ url_for(request.endpoint, **page_args) }}">{{ total_pages }}</a></li>
      {% endif %}

      <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
        <a class="page-link" href="{{ pagination.next_url or '#' }}">Next</a>
      </li>
    </ul>
  </nav>
</div>
{% endif %}

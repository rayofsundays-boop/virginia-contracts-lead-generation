{% extends "base.html" %}

{% block title %}Quick Wins - Urgent Opportunities - VA Contracts{% endblock %}

{% block content %}
<!-- Hero Section with Premium Gradient -->
<div class="container-fluid py-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="container">
        <div class="text-center text-white py-4">
            <h1 class="display-3 fw-bold mb-3" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.3);">
                ‚ö° QUICK WINS
            </h1>
            <p class="lead mb-4">Hot opportunities requiring immediate response</p>
            <div class="d-flex justify-content-center gap-3 flex-wrap">
                <a href="{{ url_for('quick_wins', expiring='7days') }}" class="badge bg-danger fs-5 px-4 py-2 pulse-animation text-decoration-none" style="cursor: pointer;">
                    <i class="fas fa-clock me-2"></i>{{ expiring_7days_count }} Expiring in 7 Days
                </a>
                <span class="badge bg-success fs-5 px-4 py-2">
                    <i class="fas fa-bolt me-2"></i>{{ quick_win_count }} Quick Wins
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Filters -->
<div class="container mt-4">
    <!-- Demo Notice Banner -->
    <div class="alert alert-info alert-dismissible fade show border-0 shadow-sm" role="alert">
        <div class="d-flex align-items-start">
            <i class="fas fa-info-circle fa-2x me-3 text-info"></i>
            <div>
                <h5 class="alert-heading mb-2">Demo Opportunities Notice</h5>
                <p class="mb-0">Some opportunities shown are examples for demonstration purposes. Website links for demo opportunities will direct you to SAM.gov or the respective government contracting portal where you can find similar real opportunities.</p>
            </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    
    <div class="card shadow-sm border-0">
        <div class="card-body">
            <form method="GET" action="{{ url_for('quick_wins') }}" class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label class="form-label fw-bold">
                        <i class="fas fa-map-marker-alt text-primary me-2"></i>City
                    </label>
                    <select class="form-select form-select-lg" name="city">
                        <option value="">All Cities</option>
                        <option value="Hampton" {% if request.args.get('city') == 'Hampton' %}selected{% endif %}>Hampton</option>
                        <option value="Newport News" {% if request.args.get('city') == 'Newport News' %}selected{% endif %}>Newport News</option>
                        <option value="Virginia Beach" {% if request.args.get('city') == 'Virginia Beach' %}selected{% endif %}>Virginia Beach</option>
                        <option value="Suffolk" {% if request.args.get('city') == 'Suffolk' %}selected{% endif %}>Suffolk</option>
                        <option value="Williamsburg" {% if request.args.get('city') == 'Williamsburg' %}selected{% endif %}>Williamsburg</option>
                        <option value="Norfolk" {% if request.args.get('city') == 'Norfolk' %}selected{% endif %}>Norfolk</option>
                        <option value="Chesapeake" {% if request.args.get('city') == 'Chesapeake' %}selected{% endif %}>Chesapeake</option>
                        <option value="Portsmouth" {% if request.args.get('city') == 'Portsmouth' %}selected{% endif %}>Portsmouth</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label fw-bold">
                        <i class="fas fa-dollar-sign text-success me-2"></i>Min Value
                    </label>
                    <select class="form-select form-select-lg" name="min_value">
                        <option value="">Any Value</option>
                        <option value="10000">$10,000+</option>
                        <option value="25000">$25,000+</option>
                        <option value="50000">$50,000+</option>
                        <option value="100000">$100,000+</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary btn-lg w-100">
                        <i class="fas fa-search me-2"></i>Filter Results
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Quick Win Opportunities -->
<div class="container my-5">
    {% if leads %}
        <div class="row g-4">
            {% for lead in leads %}
            <div class="col-12">
                <div class="card shadow-lg border-0 hover-card {% if lead.urgency_level == 'emergency' %}border-start border-danger border-5{% elif lead.urgency_level == 'urgent' %}border-start border-warning border-5{% else %}border-start border-success border-5{% endif %}">
                    <!-- Card Header -->
                    <div class="card-header bg-light border-0 py-3">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h4 class="mb-1 fw-bold text-dark">
                                    {% if lead.urgency_level == 'emergency' %}
                                        <span class="badge bg-danger me-2 pulse-animation">üî¥ EMERGENCY</span>
                                    {% elif lead.urgency_level == 'urgent' %}
                                        <span class="badge bg-warning text-dark me-2">üü† URGENT</span>
                                    {% else %}
                                        <span class="badge bg-success me-2">‚ö° QUICK WIN</span>
                                    {% endif %}
                                    {% if lead.source == 'government' %}
                                        <a href="{{ url_for('contracts') }}#contract-{{ lead.id.split('_')[1] }}" class="text-dark text-decoration-none hover-underline">
                                            {{ lead.title }}
                                        </a>
                                    {% else %}
                                        {{ lead.title }}
                                    {% endif %}
                                </h4>
                                <p class="mb-0 text-muted">
                                    <span class="badge bg-primary me-2">{{ lead.lead_type }}</span>
                                    {% if lead.state %}
                                        <span class="badge bg-info me-2">üìç {{ lead.state }}</span>
                                    {% endif %}
                                    <i class="fas fa-map-marker-alt me-1"></i>{{ lead.location }}
                                </p>
                            </div>
                            <div class="col-md-4 text-md-end mt-2 mt-md-0">
                                <div class="h3 mb-0 text-success fw-bold">{{ lead.value | currency }}</div>
                                <small class="text-muted">Estimated Value</small>
                                <div class="mt-1">
                                    <small class="text-warning fst-italic d-block">
                                        <i class="fas fa-exclamation-triangle me-1"></i>Not the true contract price
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <div class="row g-4">
                            <!-- Left Column: Details -->
                            <div class="col-lg-7">
                                <div class="mb-3">
                                    <h6 class="fw-bold text-secondary mb-2">
                                        <i class="fas fa-info-circle me-2"></i>Opportunity Details
                                    </h6>
                                    <div class="row g-2">
                                        <div class="col-md-6">
                                            <div class="p-3 bg-light rounded">
                                                <small class="text-muted d-block">Agency/Client</small>
                                                <strong>{{ lead.agency }}</strong>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="p-3 bg-light rounded">
                                                <small class="text-muted d-block">
                                                    {% if lead.source == 'supply' %}Bid Deadline{% else %}Response Time{% endif %}
                                                </small>
                                                <strong class="text-danger">
                                                    <i class="fas fa-clock me-1"></i>{{ lead.deadline }}
                                                </strong>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <h6 class="fw-bold text-secondary mb-2">
                                        <i class="fas fa-clipboard-list me-2"></i>Services/Products Needed
                                    </h6>
                                    <div class="p-3 bg-light rounded">
                                        <p class="mb-0">{{ lead.category }}</p>
                                        {% if lead.description %}
                                        <p class="mb-0 mt-2 text-muted small">{{ lead.description }}</p>
                                        {% endif %}
                                    </div>
                                </div>

                                {% if lead.website_url %}
                                <div class="mb-3">
                                    <h6 class="fw-bold text-secondary mb-2">
                                        <i class="fas fa-globe me-2"></i>Official Source
                                    </h6>
                                    <div class="p-3 bg-light rounded">
                                        <a href="{{ lead.website_url | safe_url }}" target="_blank" class="btn btn-primary w-100 mb-2" rel="noopener noreferrer">
                                            <i class="fas fa-external-link-alt me-2"></i>View Full Opportunity Details
                                        </a>
                                        <small class="text-muted d-block">
                                            <i class="fas fa-link me-1"></i>{{ lead.website_url | safe_url }}
                                        </small>
                                    </div>
                                </div>
                                {% endif %}

                                {% if lead.is_small_business %}
                                <div class="alert alert-info mb-0">
                                    <i class="fas fa-award me-2"></i>
                                    <strong>Small Business Set-Aside</strong> - Priority for certified small businesses
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- Right Column: Contact & Actions -->
                            <div class="col-lg-5">
                                {% if is_paid_subscriber or is_admin %}
                                    <!-- Contact Information (Subscribers Only) -->
                                    <div class="card border-success mb-3">
                                        <div class="card-header bg-success text-white">
                                            <h6 class="mb-0">
                                                <i class="fas fa-phone-alt me-2"></i>Contact Information
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="mb-3">
                                                <small class="text-muted d-block">Contact Person</small>
                                                <strong><i class="fas fa-user me-2 text-primary"></i>{{ lead.contact_name }}</strong>
                                            </div>
                                            {% if lead.email != 'N/A' %}
                                            <div class="mb-3">
                                                <small class="text-muted d-block">Email</small>
                                                <a href="mailto:{{ lead.email }}" class="text-decoration-none">
                                                    <i class="fas fa-envelope me-2 text-primary"></i>{{ lead.email }}
                                                </a>
                                            </div>
                                            {% endif %}
                                            {% if lead.phone != 'N/A' %}
                                            <div class="mb-0">
                                                <small class="text-muted d-block">Phone</small>
                                                <a href="tel:{{ lead.phone }}" class="text-decoration-none">
                                                    <i class="fas fa-phone me-2 text-primary"></i>{{ lead.phone }}
                                                </a>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <!-- Action Buttons (Subscribers Only) -->
                                    <div class="d-grid gap-2">
                                        {% if lead.phone != 'N/A' %}
                                        <a href="tel:{{ lead.phone }}" class="btn btn-success btn-lg">
                                            <i class="fas fa-phone-alt me-2"></i>Call Now
                                        </a>
                                        {% endif %}
                                        
                                        {% if lead.email != 'N/A' %}
                                        <a href="mailto:{{ lead.email }}?subject=Bid Response: {{ lead.title }}" class="btn btn-primary btn-lg">
                                            <i class="fas fa-envelope me-2"></i>Email Contact
                                        </a>
                                        {% endif %}
                                        
                                        {% if lead.website_url %}
                                        <a href="{{ lead.website_url | safe_url }}" target="_blank" class="btn btn-outline-primary btn-lg" rel="noopener noreferrer">
                                            <i class="fas fa-external-link-alt me-2"></i>View Official Bid
                                        </a>
                                        {% endif %}
                                        
                                        <a href="{{ url_for('ai_proposal_generator') }}?lead_title={{ lead.title }}" class="btn btn-outline-secondary btn-lg">
                                            <i class="fas fa-magic me-2"></i>Generate Proposal
                                        </a>
                                    </div>

                                    <!-- Urgency Alert -->
                                    <div class="alert {% if lead.urgency_level == 'emergency' %}alert-danger{% elif lead.urgency_level == 'urgent' %}alert-warning{% else %}alert-success{% endif %} mt-3 mb-0">
                                        <strong><i class="fas fa-stopwatch me-2"></i>Time Sensitive!</strong>
                                        <p class="mb-0 small">
                                            {% if lead.urgency_level == 'emergency' %}
                                                Respond within hours for best results!
                                            {% elif lead.urgency_level == 'urgent' %}
                                                Respond this week to secure this opportunity.
                                            {% else %}
                                                Act fast - high demand opportunity!
                                            {% endif %}
                                        </p>
                                    </div>
                                {% else %}
                                    <!-- Public Info for Non-Subscribers -->
                                    {% if lead.website_url %}
                                    <div class="card border-info mb-3">
                                        <div class="card-header bg-info text-white">
                                            <h6 class="mb-0"><i class="fas fa-external-link-alt me-2"></i>Official Bid (Public)</h6>
                                        </div>
                                        <div class="card-body">
                                            <a href="{{ lead.website_url | safe_url }}" target="_blank" class="btn btn-outline-primary w-100" rel="noopener noreferrer">
                                                <i class="fas fa-external-link-alt me-2"></i>View Official Bid
                                            </a>
                                            {% if lead.solicitation_number %}
                                            <div class="small text-muted mt-2">
                                                Solicitation: <strong>{{ lead.solicitation_number }}</strong>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endif %}

                                    <!-- Locked for Non-Subscribers -->
                                    <div class="card border-warning bg-light">
                                        <div class="card-body text-center py-5">
                                            <i class="fas fa-lock fa-3x text-warning mb-3"></i>
                                            <h5 class="fw-bold mb-3">üîí Premium Content</h5>
                                            <p class="mb-4">Subscribe to unlock:</p>
                                            <ul class="list-unstyled text-start mb-4">
                                                <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Direct contact information</li>
                                                <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>One-click calling & emailing</li>
                                                <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>AI proposal generator</li>
                                                <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Full lead details</li>
                                            </ul>
                                            <a href="{{ url_for('subscription') }}" class="btn btn-warning btn-lg w-100 mb-2">
                                                <i class="fas fa-crown me-2"></i>Upgrade to Premium - $497/year
                                            </a>
                                            <small class="text-muted">Access all Quick Wins & unlimited opportunities</small>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if total_pages > 1 %}
        <nav class="mt-5" aria-label="Quick Wins pagination">
            <ul class="pagination pagination-lg justify-content-center">
                {% if page > 1 %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page - 1 }}&urgency={{ request.args.get('urgency', '') }}&city={{ request.args.get('city', '') }}">
                        <i class="fas fa-chevron-left me-2"></i>Previous
                    </a>
                </li>
                {% endif %}
                
                {% for p in range(1, total_pages + 1) %}
                    {% if p == page %}
                    <li class="page-item active"><span class="page-link">{{ p }}</span></li>
                    {% elif p <= 3 or p > total_pages - 3 or (p >= page - 1 and p <= page + 1) %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ p }}&urgency={{ request.args.get('urgency', '') }}&city={{ request.args.get('city', '') }}">{{ p }}</a>
                    </li>
                    {% elif p == 4 or p == total_pages - 3 %}
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                    {% endif %}
                {% endfor %}
                
                {% if page < total_pages %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page + 1 }}&urgency={{ request.args.get('urgency', '') }}&city={{ request.args.get('city', '') }}">
                        Next<i class="fas fa-chevron-right ms-2"></i>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    {% else %}
        <!-- No Leads -->
        <div class="text-center py-5">
            <div class="card border-0 shadow-lg mx-auto" style="max-width: 600px;">
                <div class="card-body py-5">
                    <i class="fas fa-search fa-4x text-muted mb-4"></i>
                    <h3 class="fw-bold mb-3">No Quick Wins Available</h3>
                    {% if is_admin %}
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Admin Notice:</strong> The supply_contracts table appears to be empty.
                    </div>
                    <p class="text-muted mb-4">
                        Click the button below to populate the database with 200+ supply contracts.
                    </p>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                        <a href="/admin/populate-if-empty" class="btn btn-success btn-lg">
                            <i class="fas fa-database me-2"></i>Populate Database
                        </a>
                        <a href="/admin/db-stats" class="btn btn-info btn-lg" target="_blank">
                            <i class="fas fa-chart-bar me-2"></i>View Stats
                        </a>
                    </div>
                    {% else %}
                    <p class="text-muted mb-4">
                        There are no urgent opportunities matching your filters right now.
                        <br>Quick Win opportunities are added daily - check back soon!
                    </p>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                        <a href="{{ url_for('quick_wins') }}" class="btn btn-primary btn-lg">
                            <i class="fas fa-redo me-2"></i>Clear Filters
                        </a>
                        <a href="{{ url_for('customer_leads') }}" class="btn btn-outline-primary btn-lg">
                            <i class="fas fa-list me-2"></i>View All Leads
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    {% endif %}
</div>

<!-- Upgrade CTA for Non-Subscribers -->
{% if not is_paid_subscriber and not is_admin %}
<div class="container my-5">
    <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="card-body text-white text-center py-5">
            <h2 class="fw-bold mb-4">üöÄ Ready to Win More Contracts?</h2>
            <p class="lead mb-4">Get instant access to all contact details, bid links, and AI-powered proposal tools</p>
            <div class="row justify-content-center mb-4">
                <div class="col-md-3 mb-3">
                    <i class="fas fa-bolt fa-3x mb-2"></i>
                    <h5>Fast Response</h5>
                    <p class="small">Direct contact info for quick bids</p>
                </div>
                <div class="col-md-3 mb-3">
                    <i class="fas fa-magic fa-3x mb-2"></i>
                    <h5>AI Proposals</h5>
                    <p class="small">Generate winning bids instantly</p>
                </div>
                <div class="col-md-3 mb-3">
                    <i class="fas fa-infinity fa-3x mb-2"></i>
                    <h5>Unlimited Access</h5>
                    <p class="small">All leads, no restrictions</p>
                </div>
                <div class="col-md-3 mb-3">
                    <i class="fas fa-headset fa-3x mb-2"></i>
                    <h5>Priority Support</h5>
                    <p class="small">Expert help when you need it</p>
                </div>
            </div>
            <a href="{{ url_for('subscription') }}" class="btn btn-warning btn-lg px-5 py-3">
                <i class="fas fa-crown me-2"></i>Start Premium Now - $497/year
            </a>
            <p class="mt-3 mb-0 small">Cancel anytime ‚Ä¢ 30-day money-back guarantee</p>
        </div>
    </div>
</div>
{% endif %}

<!-- Global Procurement Disclaimer -->
{% include 'components/disclaimer.html' %}

<style>
@keyframes pulse-animation {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.9; }
}

.pulse-animation {
    animation: pulse-animation 2s infinite;
}

.hover-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.hover-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.2) !important;
}

.form-select {
    background-color: white !important;
    color: #1a252f !important;
    border: 2px solid #667eea !important;
    font-weight: 500 !important;
    cursor: pointer !important;
}

.form-select option {
    background-color: white !important;
    color: #1a252f !important;
    font-weight: 500 !important;
}

.form-select:focus,
.btn:focus {
    box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
    border-color: #764ba2 !important;
}

.form-select:hover {
    border-color: #764ba2 !important;
}

.card-header {
    border-bottom: 2px solid rgba(0,0,0,0.05);
}

.hover-underline {
    transition: all 0.2s ease;
}

.hover-underline:hover {
    text-decoration: underline !important;
    color: #667eea !important;
}
</style>
{% endblock %}

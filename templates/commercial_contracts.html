{% extends "base.html" %}

{% block title %}Property Managers Nationwide - Vendor Applications{% endblock %}

{% block og_title %}Property Management Companies - Apply as Cleaning Vendor{% endblock %}
{% block og_description %}Directory of major property management companies nationwide with direct links to apply as a cleaning vendor.{% endblock %}

{% block content %}

<!-- Property Managers Hero -->
<div class="hero-section text-center py-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="container">
        <h1 class="display-2 fw-bold text-white mb-3">üè¢ Property Managers Nationwide</h1>
        <p class="lead text-white fs-3">Apply directly as a cleaning vendor with top property management companies</p>
        <div class="row justify-content-center mt-4">
            <div class="col-md-8">
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="badge bg-light text-dark p-3 fs-6 w-100">
                            <i class="fas fa-building"></i><br>
                            <strong>{{ total_managers }}</strong> Companies{% if state_filter or city_filter or search_query %} (filtered){% endif %}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="badge bg-warning text-dark p-3 fs-6 w-100">
                            <i class="fas fa-map-marked-alt"></i><br>
                            <strong>All 50</strong> States
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="badge bg-success text-white p-3 fs-6 w-100">
                            <i class="fas fa-link"></i><br>
                            <strong>Direct</strong> Vendor Links
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Filters Section -->
<div class="container my-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Filter Property Managers</h5>
        </div>
        <div class="card-body">
            <form method="get" action="{{ url_for('commercial_contracts') }}" id="filterForm">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label for="state" class="form-label">State (HQ)</label>
                        <select name="state" id="state" class="form-select" onchange="document.getElementById('filterForm').submit()">
                            <option value="">All States</option>
                            {% for state in all_states %}
                            <option value="{{ state }}" {% if state_filter == state %}selected{% endif %}>{{ state }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="city" class="form-label">City (HQ)</label>
                        <select name="city" id="city" class="form-select" onchange="document.getElementById('filterForm').submit()">
                            <option value="">All Cities</option>
                            {% for city in all_cities %}
                            <option value="{{ city }}" {% if city_filter == city %}selected{% endif %}>{{ city }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="q" class="form-label">Search</label>
                        <input type="text" name="q" id="q" class="form-control" 
                               placeholder="Search by name, description, regions..." 
                               value="{{ search_query or '' }}">
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-search me-2"></i>Search
                        </button>
                    </div>
                </div>
                {% if state_filter or city_filter or search_query %}
                <div class="mt-3">
                    <a href="{{ url_for('commercial_contracts') }}" class="btn btn-outline-secondary btn-sm">
                        <i class="fas fa-times me-2"></i>Clear All Filters
                    </a>
                    {% if state_filter %}
                    <span class="badge bg-info ms-2">State: {{ state_filter }}</span>
                    {% endif %}
                    {% if city_filter %}
                    <span class="badge bg-info ms-2">City: {{ city_filter }}</span>
                    {% endif %}
                    {% if search_query %}
                    <span class="badge bg-info ms-2">Search: "{{ search_query }}"</span>
                    {% endif %}
                </div>
                {% endif %}
            </form>
        </div>
    </div>
</div>

<!-- Info Banner -->
<div class="container my-4">
    <div class="alert alert-info">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h5 class="mb-2"><i class="fas fa-info-circle me-2"></i>How to Use This Directory</h5>
                <p class="mb-0">Each company listed below manages thousands of properties nationwide. Click the "Apply as Vendor" button to go directly to their vendor application or contact page. Tip: Apply to multiple companies to maximize your opportunities!</p>
            </div>
            <div class="col-md-4 text-center">
                <i class="fas fa-handshake fa-4x text-primary"></i>
            </div>
        </div>
    </div>
</div>

<!-- Property Managers Directory -->
<div class="container my-5">
    <div class="row g-4">
        {% for pm in property_managers %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm hover-lift" style="transition: transform 0.2s;">
                <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h5 class="mb-0 text-white">
                        <i class="fas fa-building me-2"></i>{{ pm.name }}
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted d-block"><i class="fas fa-map-marker-alt me-1"></i>Headquarters</small>
                        <strong>{{ pm.location }}</strong>
                    </div>
                    
                    <div class="mb-3">
                        <small class="text-muted d-block"><i class="fas fa-city me-1"></i>Portfolio Size</small>
                        <strong class="text-success">{{ pm.properties }}</strong>
                    </div>
                    
                    <div class="mb-3">
                        <small class="text-muted d-block"><i class="fas fa-globe me-1"></i>Coverage</small>
                        <strong>{{ pm.regions }}</strong>
                    </div>
                    
                    <div class="mb-3">
                        <small class="text-muted d-block"><i class="fas fa-warehouse me-1"></i>Property Types</small>
                        <span class="badge bg-info">{{ pm.property_types }}</span>
                    </div>
                    
                    <div class="mb-3">
                        <p class="small text-muted mb-0">{{ pm.description }}</p>
                    </div>
                </div>
                <div class="card-footer bg-light">
                    <a href="{{ pm.vendor_link }}" target="_blank" class="btn btn-primary w-100" rel="noopener noreferrer">
                        <i class="fas fa-external-link-alt me-2"></i>Apply as Vendor
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Pagination -->
    {% if total_pages > 1 %}
    <nav aria-label="Property managers pagination" class="mt-5">
        <ul class="pagination justify-content-center">
            <!-- Previous Button -->
            <li class="page-item {% if page == 1 %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('commercial_contracts', page=page-1, state=state_filter, city=city_filter, q=search_query, per_page=per_page) }}">
                    <i class="fas fa-chevron-left"></i> Previous
                </a>
            </li>
            
            <!-- First Page -->
            {% if page > 3 %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('commercial_contracts', page=1, state=state_filter, city=city_filter, q=search_query, per_page=per_page) }}">1</a>
            </li>
            {% if page > 4 %}
            <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
            {% endif %}
            
            <!-- Page Numbers -->
            {% for p in range([1, page-2]|max, [total_pages, page+2]|min + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('commercial_contracts', page=p, state=state_filter, city=city_filter, q=search_query, per_page=per_page) }}">{{ p }}</a>
            </li>
            {% endfor %}
            
            <!-- Last Page -->
            {% if page < total_pages - 2 %}
            {% if page < total_pages - 3 %}
            <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('commercial_contracts', page=total_pages, state=state_filter, city=city_filter, q=search_query, per_page=per_page) }}">{{ total_pages }}</a>
            </li>
            {% endif %}
            
            <!-- Next Button -->
            <li class="page-item {% if page == total_pages %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('commercial_contracts', page=page+1, state=state_filter, city=city_filter, q=search_query, per_page=per_page) }}">
                    Next <i class="fas fa-chevron-right"></i>
                </a>
            </li>
        </ul>
        
        <div class="text-center text-muted mt-3">
            <small>Showing {{ (page-1) * per_page + 1 }}-{{ [page * per_page, total_managers]|min }} of {{ total_managers }} companies</small>
        </div>
    </nav>
    {% endif %}
</div>

<!-- Tips Section -->
<div class="container my-5">
    <div class="card border-primary">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Vendor Application Tips</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5 class="text-primary">Before Applying:</h5>
                    <ul>
                        <li>Have your business license and insurance certificates ready</li>
                        <li>Prepare a list of your services and service areas</li>
                        <li>Get references from current clients</li>
                        <li>Document your safety training and certifications</li>
                        <li>Have financial statements if required</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5 class="text-success">Application Best Practices:</h5>
                    <ul>
                        <li>Apply to multiple companies to increase opportunities</li>
                        <li>Follow up 1-2 weeks after applying</li>
                        <li>Highlight any property management experience</li>
                        <li>Emphasize 24/7 availability and quick response times</li>
                        <li>Be prepared for background checks and site visits</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Success Stories -->
<div class="container my-5">
    <div class="card bg-light">
        <div class="card-body">
            <h4 class="text-center mb-4"><i class="fas fa-star me-2 text-warning"></i>Success Stories</h4>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-quote-left fa-2x text-primary mb-3"></i>
                            <p class="mb-3">"Applied to 5 companies from this list and got approved by 3 within a month. Now servicing 15+ properties!"</p>
                            <small class="text-muted">- Small Business Owner, TX</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-quote-left fa-2x text-primary mb-3"></i>
                            <p class="mb-3">"The vendor application links saved me hours of research. Within 2 months, I had contracts with 2 major property managers."</p>
                            <small class="text-muted">- Cleaning Company, FL</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-quote-left fa-2x text-primary mb-3"></i>
                            <p class="mb-3">"Best resource for growing my business. Direct links made the process so much easier than cold calling."</p>
                            <small class="text-muted">- Janitorial Services, CA</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.hover-lift:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.2) !important;
}

.card-header h5 {
    font-size: 1rem;
}
</style>

{% endblock %}
                            <strong>Full Access</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Filter Section -->
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Filter Commercial Opportunities</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Business Type:</label>
                            <select class="form-select" id="businessTypeFilter">
                                <option value="">All Types</option>
                                <option value="medical">Medical/Dental</option>
                                <option value="legal">Legal Services</option>
                                <option value="real-estate">Real Estate</option>
                                <option value="fitness">Fitness Centers</option>
                                <option value="hospitality">Hotels/Lodging</option>
                                <option value="education">Education Centers</option>
                                <option value="office">Office Spaces</option>
                                <option value="healthcare">Healthcare/Nursing</option>
                                <option value="childcare">Childcare</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Location:</label>
                            <select class="form-select" id="locationFilter">
                                <option value="">All Locations</option>
                                <option value="Hampton">Hampton</option>
                                <option value="Suffolk">Suffolk</option>
                                <option value="Virginia Beach">Virginia Beach</option>
                                <option value="Newport News">Newport News</option>
                                <option value="Williamsburg">Williamsburg</option>
                                <option value="Norfolk">Norfolk</option>
                                <option value="Chesapeake">Chesapeake</option>
                                <option value="Portsmouth">Portsmouth</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Size:</label>
                            <select class="form-select" id="sizeFilter">
                                <option value="">All Sizes</option>
                                <option value="small">Small (Under 5,000 sq ft)</option>
                                <option value="medium">Medium (5,000-15,000 sq ft)</option>
                                <option value="large">Large (15,000+ sq ft)</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Frequency:</label>
                            <select class="form-select" id="frequencyFilter">
                                <option value="">All Frequencies</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="bi-weekly">Bi-weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="one-time">One-time</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
                            <button class="btn btn-outline-secondary" onclick="clearFilters()">Clear All</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Commercial Opportunities Section -->
<div class="container my-5">
    <div class="row" id="commercial-opportunities">
        {% for opportunity in opportunities %}
        <div class="col-md-6 col-lg-4 mb-4 opportunity-card" 
             data-type="{{ opportunity.business_type }}" 
             data-location="{{ opportunity.location }}" 
             data-size="{{ opportunity.size }}"
             data-frequency="{{ opportunity.frequency }}">
            <div class="card h-100 contract-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 text-primary">{{ opportunity.business_type | title }}</h6>
                    <span class="badge bg-success">{{ opportunity.frequency | title }}</span>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title">{{ opportunity.business_name }}</h5>
                        <span class="city-badge">{{ opportunity.location }}</span>
                    </div>
                    <h6 class="card-subtitle mb-2 text-muted">{{ opportunity.address }}</h6>
                    <p class="card-text">{{ opportunity.description }}</p>
                    
                    <div class="row">
                        <div class="col-6">
                            <small class="text-muted">Est. Monthly Value:</small><br>
                            <strong class="text-success">${{ opportunity.monthly_value }}</strong>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Square Footage:</small><br>
                            <strong>{{ opportunity.square_footage | comma }} sq ft</strong>
                        </div>
                    </div>
                    
                    <div class="row mt-2">
                        <div class="col-6">
                            <small class="text-muted">Services Needed:</small><br>
                            <small>{{ opportunity.services_needed }}</small>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Contact:</small><br>
                            <small>{{ opportunity.contact_type }}</small>
                        </div>
                    </div>
                    
                    <div class="mt-2">
                        <small class="text-muted">Special Requirements:</small><br>
                        <small class="text-info">{{ opportunity.special_requirements }}</small>
                    </div>
                </div>
                <div class="card-footer bg-transparent d-flex justify-content-between align-items-center">
                    <div>
                        <button class="btn btn-primary btn-sm" onclick="requestContact('{{ opportunity.id }}', '{{ opportunity.business_name }}')">
                            <i class="fas fa-coins"></i> Get Contact Info
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="shareCommercialOpportunity('{{ opportunity.business_name | safe }}', '{{ opportunity.description[:150] | safe }}...', '{{ opportunity.location }}', '${{ opportunity.monthly_value }}', '{{ opportunity.business_type }}')">
                            <i class="fas fa-share-alt"></i> Share
                        </button>
                    </div>
                    <div class="text-end">
                        <small class="text-muted">Access:</small><br>
                        <strong class="text-success">Included</strong>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Business Types Overview -->
<div class="bg-light py-5">
    <div class="container">
        <h2 class="text-center mb-5">Commercial Cleaning Opportunities by Sector</h2>
        
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-user-md fa-3x text-primary mb-3"></i>
                        <h5>Medical & Dental</h5>
                        <p>Dental offices, doctor's offices, medical practices, urgent care centers</p>
                        <ul class="list-unstyled small">
                            <li>‚Ä¢ High-frequency cleaning</li>
                            <li>‚Ä¢ Specialized sanitization</li>
                            <li>‚Ä¢ HIPAA compliance required</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-dumbbell fa-3x text-success mb-3"></i>
                        <h5>Fitness & Wellness</h5>
                        <p>Gyms, fitness centers, yoga studios, wellness centers</p>
                        <ul class="list-unstyled small">
                            <li>‚Ä¢ Locker room cleaning</li>
                            <li>‚Ä¢ Equipment sanitization</li>
                            <li>‚Ä¢ High-traffic areas</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-balance-scale fa-3x text-warning mb-3"></i>
                        <h5>Legal & Professional</h5>
                        <p>Law offices, accounting firms, consulting companies</p>
                        <ul class="list-unstyled small">
                            <li>‚Ä¢ Professional appearance</li>
                            <li>‚Ä¢ Confidentiality important</li>
                            <li>‚Ä¢ Flexible scheduling</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-home fa-3x text-info mb-3"></i>
                        <h5>Real Estate & Property</h5>
                        <p>Real estate offices, property management companies, leasing offices</p>
                        <ul class="list-unstyled small">
                            <li>‚Ä¢ Move-out cleaning</li>
                            <li>‚Ä¢ Show-ready maintenance</li>
                            <li>‚Ä¢ Variable scheduling</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-hotel fa-3x text-secondary mb-3"></i>
                        <h5>Hospitality</h5>
                        <p>Hotels, motels, bed & breakfasts, extended stay facilities</p>
                        <ul class="list-unstyled small">
                            <li>‚Ä¢ Daily housekeeping</li>
                            <li>‚Ä¢ Deep cleaning services</li>
                            <li>‚Ä¢ 24/7 availability</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-graduation-cap fa-3x text-danger mb-3"></i>
                        <h5>Education & Childcare</h5>
                        <p>Private schools, daycare centers, tutoring centers, training facilities</p>
                        <ul class="list-unstyled small">
                            <li>‚Ä¢ Child-safe products</li>
                            <li>‚Ä¢ After-hours cleaning</li>
                            <li>‚Ä¢ Background checks required</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CTA Section -->
<div class="cta-section text-center">
    <div class="container">
        <h3>Ready to Connect with Commercial Clients?</h3>
        <p class="lead">Register to receive notifications about new commercial cleaning opportunities.</p>
        <a href="{{ url_for('register') }}" class="btn btn-light btn-lg">Get Commercial Leads</a>
    </div>
</div>

<script>
function applyFilters() {
    const businessType = document.getElementById('businessTypeFilter').value;
    const location = document.getElementById('locationFilter').value;
    const size = document.getElementById('sizeFilter').value;
    const frequency = document.getElementById('frequencyFilter').value;
    
    const cards = document.querySelectorAll('.opportunity-card');
    
    cards.forEach(card => {
        let show = true;
        
        if (businessType && card.dataset.type !== businessType) show = false;
        if (location && card.dataset.location !== location) show = false;
        if (size && card.dataset.size !== size) show = false;
        if (frequency && card.dataset.frequency !== frequency) show = false;
        
        card.style.display = show ? 'block' : 'none';
    });
}

function clearFilters() {
    document.getElementById('businessTypeFilter').value = '';
    document.getElementById('locationFilter').value = '';
    document.getElementById('sizeFilter').value = '';
    document.getElementById('frequencyFilter').value = '';
    
    const cards = document.querySelectorAll('.opportunity-card');
    cards.forEach(card => {
        card.style.display = 'block';
    });
}

function requestContact(opportunityId, businessName) {
    // Check credits before proceeding
    if (!checkCreditsBeforeRequest()) {
        return; // Credits check failed, alert shown by base template function
    }

    if (confirm(`Request contact information for ${businessName}?\n\nAccess is included with your subscription.`)) {
        // Disable the button to prevent double-clicks
        const buttons = document.querySelectorAll(`button[onclick*="${opportunityId}"]`);
        buttons.forEach(btn => {
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        });

        fetch('/request-commercial-contact', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                opportunity_id: opportunityId,
                business_name: businessName,
                user_email: 'demo@example.com' // In real app, get from session
            })
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                // Update credits in navigation
                updateCreditsAfterRequest(result.credits_used || 5);
                
                // Show success message with contact info
                showContactInfoModal(result.contact_info, businessName, result.new_credits_balance);
                
                // Show low credits alert if needed
                if (result.new_credits_balance <= 10 && result.new_credits_balance > 0) {
                    setTimeout(() => showCreditsAlert('low'), 2000);
                } else if (result.new_credits_balance === 0) {
                    setTimeout(() => showCreditsAlert('out'), 2000);
                }
            } else {
                showToastCommercial(result.message || 'Error requesting contact information.', 'error');
                
                // If it's a credits issue, show credits alert
                if (result.message && result.message.toLowerCase().includes('credit')) {
                    setTimeout(() => showCreditsAlert(result.credits_balance === 0 ? 'out' : 'low'), 1000);
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showToastCommercial('Error requesting contact information. Please try again.', 'error');
        })
        .finally(() => {
            // Re-enable buttons
            buttons.forEach(btn => {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-coins"></i> Get Contact Info';
            });
        });
    }
}

function showContactInfoModal(contactInfo, businessName, newCreditsBalance) {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'contactInfoModal';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-check-circle"></i> Contact Information Retrieved
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-success">
                        <strong>Success!</strong> Contact information for <strong>${businessName}</strong> has been sent to your email.
                        <br><small class="text-muted">Credits remaining: ${newCreditsBalance}</small>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-user"></i> Contact Person</h6>
                            <p class="mb-3">${contactInfo.contact_person || 'N/A'}</p>
                            
                            <h6><i class="fas fa-envelope"></i> Email</h6>
                            <p class="mb-3">
                                <a href="mailto:${contactInfo.email}">${contactInfo.email}</a>
                                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('${contactInfo.email}')">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-phone"></i> Phone</h6>
                            <p class="mb-3">
                                <a href="tel:${contactInfo.phone}">${contactInfo.phone}</a>
                                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('${contactInfo.phone}')">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </p>
                            
                            <h6><i class="fas fa-building"></i> Business</h6>
                            <p class="mb-3">${businessName}</p>
                        </div>
                    </div>
                    
                    ${contactInfo.website ? `
                        <div class="mt-3">
                            <h6><i class="fas fa-globe"></i> Website</h6>
                            <p><a href="${contactInfo.website}" target="_blank">${contactInfo.website}</a></p>
                        </div>
                    ` : ''}
                    
                    ${contactInfo.best_time_to_contact ? `
                        <div class="mt-3">
                            <h6><i class="fas fa-clock"></i> Best Time to Contact</h6>
                            <p>${contactInfo.best_time_to_contact}</p>
                        </div>
                    ` : ''}
                    
                    ${contactInfo.special_notes ? `
                        <div class="mt-3">
                            <h6><i class="fas fa-info-circle"></i> Special Notes</h6>
                            <p class="text-muted">${contactInfo.special_notes}</p>
                        </div>
                    ` : ''}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="window.location.href='/credits'">
                        <i class="fas fa-coins"></i> Buy More Credits
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    
    // Clean up modal after hiding
    modal.addEventListener('hidden.bs.modal', () => {
        document.body.removeChild(modal);
    });
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        showToastCommercial('Copied to clipboard!', 'success');
    }).catch(err => {
        console.error('Failed to copy: ', err);
        showToastCommercial('Failed to copy', 'error');
    });
}

function shareCommercialOpportunity(businessName, description, location, value, type) {
    const shareData = {
        title: `${businessName} - Commercial Cleaning Opportunity`,
        text: `${description}\n\nLocation: ${location}\nValue: ${value}/month\nType: ${type}\n\nVia VA Contract Hub`,
        url: window.location.href
    };
    
    // Try native sharing first (mobile devices)
    if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
        navigator.share(shareData)
            .then(() => console.log('Opportunity shared successfully'))
            .catch((error) => {
                console.log('Error sharing:', error);
                fallbackShareCommercial(shareData);
            });
    } else {
        // Fallback to custom share modal
        fallbackShareCommercial(shareData);
    }
}

function fallbackShareCommercial(shareData) {
    // Create share modal (similar to contracts.html)
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Share Commercial Opportunity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Share Link:</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="shareCommercialUrl" value="${shareData.url}" readonly>
                            <button class="btn btn-outline-secondary" onclick="copyToClipboardCommercial('shareCommercialUrl')">Copy</button>
                        </div>
                    </div>
                    <div class="row text-center">
                        <div class="col-4">
                            <a href="mailto:?subject=${encodeURIComponent(shareData.title)}&body=${encodeURIComponent(shareData.text + '\\n\\n' + shareData.url)}" 
                               class="btn btn-outline-primary w-100 mb-2">
                                <i class="fas fa-envelope"></i><br>Email
                            </a>
                        </div>
                        <div class="col-4">
                            <a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(shareData.text)}&url=${encodeURIComponent(shareData.url)}" 
                               target="_blank" class="btn btn-outline-info w-100 mb-2">
                                <i class="fab fa-twitter"></i><br>Twitter
                            </a>
                        </div>
                        <div class="col-4">
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(shareData.url)}" 
                               target="_blank" class="btn btn-outline-primary w-100 mb-2">
                                <i class="fab fa-linkedin"></i><br>LinkedIn
                            </a>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    
    // Clean up modal after hiding
    modal.addEventListener('hidden.bs.modal', () => {
        document.body.removeChild(modal);
    });
}

function copyToClipboardCommercial(elementId) {
    const element = document.getElementById(elementId);
    element.select();
    element.setSelectionRange(0, 99999);
    
    try {
        document.execCommand('copy');
        showToastCommercial('Link copied to clipboard!', 'success');
    } catch (err) {
        console.error('Failed to copy: ', err);
        showToastCommercial('Failed to copy link', 'error');
    }
}

function showToastCommercial(message, type) {
    // Create toast notification
    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-white bg-${type === 'success' ? 'success' : 'danger'} border-0`;
    toast.setAttribute('role', 'alert');
    toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">${message}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    `;
    
    // Add to page
    let toastContainer = document.querySelector('.toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
        document.body.appendChild(toastContainer);
    }
    
    toastContainer.appendChild(toast);
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
    
    // Clean up after hiding
    toast.addEventListener('hidden.bs.toast', () => {
        toastContainer.removeChild(toast);
    });
}
</script>

<style>
.cta-section {
    background: linear-gradient(135deg, #198754, #20c997);
    color: white;
    padding: 3rem 0;
}
</style>


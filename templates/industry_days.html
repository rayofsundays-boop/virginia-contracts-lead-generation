{% extends "base.html" %}

{% block title %}Industry Days & Events - All 50 States | ContractLink.ai{% endblock %}

{% block content %}
<!-- Force Render deployment: Nov 10, 2025 - All 50 states display fix -->
<div class="container mt-5 pt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <h2 class="mb-2">
                        <i class="fas fa-calendar-alt me-2 text-primary"></i>Industry Days & Procurement Events
                    </h2>
                    <p class="text-muted mb-0">
                        <i class="fas fa-flag-usa me-2"></i>
                        Network, learn, and discover opportunities across all 50 states
                    </p>
                </div>
                <a href="{{ url_for('customer_leads') }}" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Portal
                </a>
            </div>
            
            <!-- Stats Cards -->
            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-calendar-check fa-2x text-success mb-2"></i>
                            <h4 class="mb-0">{{ total_count }}</h4>
                            <small class="text-muted">Upcoming Events</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm bg-success text-white">
                        <div class="card-body text-center">
                            <i class="fas fa-flag-usa fa-2x mb-2"></i>
                            <h4 class="mb-0">All 50</h4>
                            <small>US States Covered</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-map-marker-alt fa-2x text-info mb-2"></i>
                            <h4 class="mb-0">{{ cities|length }}</h4>
                            <small class="text-muted">Cities</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-laptop fa-2x text-warning mb-2"></i>
                            <h4 class="mb-0">{{ virtual_count }}</h4>
                            <small class="text-muted">Virtual Events</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Subscriber Benefits Banner -->
    {% if not (is_paid_subscriber or is_admin) %}
    <div class="alert alert-info border-0 shadow-sm mb-4">
        <div class="row align-items-center">
            <div class="col-md-9">
                <h5 class="mb-2"><i class="fas fa-star me-2"></i>Subscriber Exclusive</h5>
                <p class="mb-0">Get full event details, registration links, and direct contact information with a premium subscription.</p>
            </div>
            <div class="col-md-3 text-end">
                <a href="{{ url_for('register') }}" class="btn btn-warning">
                    <i class="fas fa-crown me-2"></i>Upgrade Now
                </a>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- All 50 States Notice -->
    <div class="alert alert-success border-0 shadow-sm mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h5 class="mb-1">
                    <i class="fas fa-flag-usa me-2"></i>Nationwide Coverage - All 50 States
                </h5>
                <p class="mb-0">
                    <i class="fas fa-check-circle me-2 text-success"></i>
                    Browse {{ total_count }} procurement events across Alabama, Alaska, Arizona, Arkansas, California, Colorado, Connecticut, Delaware, Florida, Georgia, Hawaii, Idaho, Illinois, Indiana, Iowa, Kansas, Kentucky, Louisiana, Maine, Maryland, Massachusetts, Michigan, Minnesota, Mississippi, Missouri, Montana, Nebraska, Nevada, New Hampshire, New Jersey, New Mexico, New York, North Carolina, North Dakota, Ohio, Oklahoma, Oregon, Pennsylvania, Rhode Island, South Carolina, South Dakota, Tennessee, Texas, Utah, Vermont, Virginia, Washington, West Virginia, Wisconsin, and Wyoming.
                </p>
            </div>
            <div class="col-md-4 text-end">
                <div class="badge bg-success fs-5 px-3 py-2">
                    <i class="fas fa-map-marked-alt me-2"></i>50 States
                </div>
            </div>
        </div>
    </div>
    
    <!-- Filters -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-white">
            <h6 class="mb-0"><i class="fas fa-filter me-2"></i>Filter Events - Select from All 50 US States</h6>
        </div>
        <div class="card-body">
            <form method="GET" action="{{ url_for('industry_days') }}" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label"><i class="fas fa-flag-usa me-2"></i>State</label>
                    <select name="state" class="form-select" id="stateFilter">
                        <option value="">All States (50)</option>
                        {% for state in states %}
                        <option value="{{ state }}" {% if current_filters.state == state %}selected{% endif %}>{{ state }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label"><i class="fas fa-map-marker-alt me-2"></i>City</label>
                    <select name="city" class="form-select">
                        <option value="">All Cities ({{ cities|length }})</option>
                        {% for city in cities %}
                        <option value="{{ city }}" {% if current_filters.city == city %}selected{% endif %}>{{ city }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label"><i class="fas fa-tag me-2"></i>Event Type</label>
                    <select name="event_type" class="form-select">
                        <option value="">All Types</option>
                        {% for et in event_types %}
                        <option value="{{ et }}" {% if current_filters.event_type == et %}selected{% endif %}>{{ et }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label"><i class="fas fa-laptop me-2"></i>Format</label>
                    <select name="is_virtual" class="form-select">
                        <option value="">All Formats</option>
                        <option value="true" {% if current_filters.is_virtual == 'true' %}selected{% endif %}>Virtual Only ({{ virtual_count }})</option>
                        <option value="false" {% if current_filters.is_virtual == 'false' %}selected{% endif %}>In-Person Only</option>
                    </select>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search me-2"></i>Search Events
                    </button>
                    <a href="{{ url_for('industry_days') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-redo me-2"></i>Clear Filters
                    </a>
                    <span class="text-muted ms-3">
                        <i class="fas fa-info-circle me-1"></i>
                        Showing {{ total_count }} events
                    </span>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Events List -->
    {% if events %}
    <div class="row g-4">
        {% for event in events %}
        <div class="col-12">
            <div class="card shadow-sm border-0 hover-card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-2 text-center">
                            <div class="date-box bg-primary text-white p-3 rounded">
                                <div class="fs-4 fw-bold">{{ event.event_date.strftime('%d') }}</div>
                                <div class="small">{{ event.event_date.strftime('%b %Y') }}</div>
                                {% if event.is_virtual %}
                                <div class="mt-2">
                                    <span class="badge bg-success">Virtual</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="col-md-7">
                            <h5 class="mb-2">{{ event.event_title }}</h5>
                            <p class="mb-2">
                                <span class="badge bg-info">{{ event.event_type }}</span>
                                <span class="badge bg-primary ms-1">
                                    <i class="fas fa-flag-usa me-1"></i>{{ event.state }}
                                </span>
                                <span class="text-muted ms-2">
                                    <i class="fas fa-building me-1"></i>{{ event.organizer }}
                                </span>
                            </p>
                            
                            <p class="mb-2">
                                {% if event.is_virtual %}
                                <i class="fas fa-globe text-success me-2"></i><strong>Virtual Event</strong>
                                {% else %}
                                <i class="fas fa-map-marker-alt text-danger me-2"></i>{{ event.city }}, {{ event.state }}
                                {% if event.venue_name %}
                                <span class="text-muted ms-2">({{ event.venue_name }})</span>
                                {% endif %}
                                {% endif %}
                            </p>
                            
                            {% if event.event_time %}
                            <p class="mb-2">
                                <i class="fas fa-clock text-primary me-2"></i>{{ event.event_time }}
                            </p>
                            {% endif %}
                            
                            {% if event.description %}
                            <p class="text-muted mb-2">{{ event.description|truncate(200) }}</p>
                            {% endif %}
                            
                            {% if event.topics %}
                            <p class="mb-2">
                                <strong><i class="fas fa-list me-2"></i>Topics:</strong>
                                <span class="text-muted">{{ event.topics|truncate(150) }}</span>
                            </p>
                            {% endif %}
                            
                            {% if event.target_audience %}
                            <p class="mb-2">
                                <strong><i class="fas fa-users me-2"></i>Target Audience:</strong>
                                <span class="text-muted">{{ event.target_audience }}</span>
                            </p>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-3">
                            {% if is_paid_subscriber or is_admin %}
                            <!-- Subscriber Content -->
                            <div class="details-box bg-light p-3 rounded mb-3">
                                {% if event.registration_required %}
                                <p class="mb-2">
                                    <span class="badge bg-warning text-dark w-100">Registration Required</span>
                                </p>
                                {% if event.registration_deadline %}
                                <p class="small mb-2 text-danger">
                                    <i class="fas fa-exclamation-triangle me-1"></i>Deadline: {{ event.registration_deadline.strftime('%b %d, %Y') }}
                                </p>
                                {% endif %}
                                {% endif %}
                                
                                {% if event.contact_name %}
                                <p class="small mb-1"><strong>Contact:</strong> {{ event.contact_name }}</p>
                                {% endif %}
                                {% if event.contact_email %}
                                <p class="small mb-1"><a href="mailto:{{ event.contact_email }}">{{ event.contact_email }}</a></p>
                                {% endif %}
                                {% if event.contact_phone %}
                                <p class="small mb-1"><a href="tel:{{ event.contact_phone }}">{{ event.contact_phone }}</a></p>
                                {% endif %}
                            </div>
                            
                            {% if event.registration_link %}
                            <a href="{{ event.registration_link }}" target="_blank" class="btn btn-primary w-100 mb-2">
                                <i class="fas fa-user-plus me-2"></i>Register Now
                            </a>
                            {% endif %}
                            
                            {% if event.is_virtual and event.virtual_link %}
                            <a href="{{ event.virtual_link }}" target="_blank" class="btn btn-success w-100">
                                <i class="fas fa-video me-2"></i>Join Virtual Event
                            </a>
                            {% endif %}
                            {% else %}
                            <!-- Non-Subscriber View -->
                            <div class="alert alert-warning text-center p-3">
                                <i class="fas fa-lock fa-2x mb-2"></i>
                                <p class="small mb-2"><strong>Subscriber Only</strong></p>
                                <p class="small mb-2">Registration details & contact info</p>
                                <a href="{{ url_for('register') }}" class="btn btn-sm btn-warning w-100">
                                    <i class="fas fa-star me-1"></i>Upgrade
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Pagination -->
    {% if total_pages > 1 %}
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center flex-wrap">
            <!-- Previous Button -->
            <li class="page-item {% if page == 1 %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('industry_days', page=page-1, state=current_filters.state, city=current_filters.city, event_type=current_filters.event_type, is_virtual=current_filters.is_virtual) }}">
                    <i class="fas fa-chevron-left"></i> Previous
                </a>
            </li>
            
            <!-- First Page -->
            {% if page > 3 %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('industry_days', page=1, state=current_filters.state, city=current_filters.city, event_type=current_filters.event_type, is_virtual=current_filters.is_virtual) }}">1</a>
            </li>
            {% if page > 4 %}
            <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
            {% endif %}
            
            <!-- Page Numbers (show 5 pages max) -->
            {% for p in range([1, page - 2]|max, [total_pages, page + 2]|min + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('industry_days', page=p, state=current_filters.state, city=current_filters.city, event_type=current_filters.event_type, is_virtual=current_filters.is_virtual) }}">{{ p }}</a>
            </li>
            {% endfor %}
            
            <!-- Last Page -->
            {% if page < total_pages - 2 %}
            {% if page < total_pages - 3 %}
            <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('industry_days', page=total_pages, state=current_filters.state, city=current_filters.city, event_type=current_filters.event_type, is_virtual=current_filters.is_virtual) }}">{{ total_pages }}</a>
            </li>
            {% endif %}
            
            <!-- Next Button -->
            <li class="page-item {% if page == total_pages %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('industry_days', page=page+1, state=current_filters.state, city=current_filters.city, event_type=current_filters.event_type, is_virtual=current_filters.is_virtual) }}">
                    Next <i class="fas fa-chevron-right"></i>
                </a>
            </li>
        </ul>
        
        <!-- Page Info -->
        <div class="text-center mt-3">
            <small class="text-muted">
                <i class="fas fa-info-circle me-1"></i>
                Page {{ page }} of {{ total_pages }} | Showing {{ events|length }} of {{ total_count }} events across all 50 states
            </small>
        </div>
    </nav>
    {% endif %}
    
    {% else %}
    <!-- No Events Found -->
    <div class="card border-0 shadow-sm">
        <div class="card-body text-center py-5">
            <i class="fas fa-calendar-times fa-4x text-muted mb-3"></i>
            <h4 class="mb-3">No Upcoming Events</h4>
            <p class="text-muted mb-4">Check back later for new industry days and networking events.</p>
            <a href="{{ url_for('industry_days') }}" class="btn btn-primary">Reset Filters</a>
        </div>
    </div>
    {% endif %}
</div>

<style>
.hover-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
}

.date-box {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.details-box {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}
</style>
{% endblock %}
